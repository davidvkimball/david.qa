/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var W=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var we=Object.prototype.hasOwnProperty;var B=(o,a)=>()=>(o&&(a=o(o=0)),a);var G=(o,a)=>{for(var e in a)W(o,e,{get:a[e],enumerable:!0})},Ce=(o,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of ke(a))!we.call(o,s)&&s!==e&&W(o,s,{get:()=>a[s],enumerable:!(t=ye(a,s))||t.enumerable});return o};var ve=o=>Ce(W({},"__esModule",{value:!0}),o);function x(o){return o.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}function Ee(o){return o.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}async function z(o,a,e){let t=[];if(!e.checkAltText)return[];let s=x(o),n=s.match(/!\[([^\]]*)\]\([^)]+\)/g);if(n){let l=n.filter(u=>{var g;let c=(g=u.match(/!\[([^\]]*)\]/))==null?void 0:g[1];return!c||c.trim()===""});if(l.length>0){let u=l.length,c=u>1,g=l.map(h=>{let d=h.match(/!\[[^\]]*\]\(([^)]+)\)/);return d?d[1]:h});t.push({passed:!1,message:`${u} image${c?"s are":" is"} missing alt text`,suggestion:`Add descriptive alt text for accessibility:<br><br>${g.map(h=>`\u2022 ${h}`).join("<br>")}`,severity:"error"})}}let i=s.match(/!\[\[([^\]]+)\]\]/g);if(i){let l=i.filter(u=>!u.includes("|"));if(l.length>0){let u=l.length,c=u>1,g=l.map(h=>{let d=h.match(/!\[\[([^\]]+)\]\]/);return d?d[1]:h});t.push({passed:!1,message:`${u} wikilink image${c?"s are":" is"} missing alt text`,suggestion:`Add alt text using ![[image.png|alt text]] syntax or consider using standard markdown image syntax:<br><br>${g.map(h=>`\u2022 ${h}`).join("<br>")}`,severity:"error"})}}let r=s.match(/<img[^>]*>/g);if(r){let l=r.filter(u=>{let c=u.match(/alt\s*=\s*["']([^"']*)["']/);return!c||c[1].trim()===""});if(l.length>0){let u=l.length,c=u>1,g=l.map(h=>{let d=h.match(/src\s*=\s*["']([^"']*)["']/);return d?d[1]:"HTML img tag"});t.push({passed:!1,message:`${u} HTML image${c?"s are":" is"} missing alt attribute`,suggestion:`Add alt attribute to HTML img tags:<br><br>${g.map(h=>`\u2022 ${h}`).join("<br>")}`,severity:"error"})}}return t.length===0&&(n&&n.length>0||r&&r.length>0||i&&i.length>0?t.push({passed:!0,message:"All images have alt text",severity:"info"}):t.push({passed:!0,message:"No images in this post",severity:"info"})),t}async function _(o,a,e){let t=[];if(!e.checkNakedLinks)return[];let n=Ee(o).match(/(?<!\]\()https?:\/\/[^\s\)]+/g);return n&&n.forEach((i,r)=>{t.push({passed:!1,message:`Naked link found: ${i}`,suggestion:"Convert to markdown link format: [link text](url)",severity:"warning"})}),t.length===0&&t.push({passed:!0,message:"No naked links found",severity:"info"}),t}async function Z(o,a,e){let t=[];if(!e.checkHeadingOrder)return[];let s=o.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/~~~[\s\S]*?~~~/g,"");let n=s.split(`
`),i=null,r=!1;for(let l=0;l<n.length;l++){let c=n[l].match(/^(#{1,6})\s+(.+)/);if(c){r=!0;let g=c[1].length,h=c[2].trim();if(i===null){i=g;continue}g>i+1&&t.push({passed:!1,message:`"${h}" (H${g}) skips heading level(s) after H${i}`,suggestion:"Use heading levels in order (H1 \u2192 H2 \u2192 H3, etc.)",severity:"warning"}),i=g}}return r?t.length===0&&t.push({passed:!0,message:"Heading structure is correct",severity:"info"}):t.push({passed:!0,message:"No heading structure issues found",severity:"info"}),t}async function X(o,a,e){let t=[];if(!e.keywordProperty)return[];let s=o.match(/^---\n([\s\S]*?)\n---/);if(!s)return[];let i=s[1].match(new RegExp(`^${e.keywordProperty}:\\s*(.+)$`,"m"));if(!i)return[];let r=i[1].trim();(r.startsWith('"')&&r.endsWith('"')||r.startsWith("'")&&r.endsWith("'"))&&(r=r.slice(1,-1));let l=o.replace(/^---\n[\s\S]*?\n---\n/,""),u=l.split(/\s+/).filter(h=>h.length>0).length,c=(l.toLowerCase().match(new RegExp(r.toLowerCase(),"g"))||[]).length,g=u>0?c/u*100:0;return c===0?t.push({passed:!1,message:`Target keyword "${r}" not found in content`,suggestion:"Include your target keyword naturally in the content",severity:"warning"}):g<e.keywordDensityMin?t.push({passed:!1,message:`Keyword density too low: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${e.keywordDensityMin}-${e.keywordDensityMax}% density`,severity:"warning"}):g>e.keywordDensityMax?t.push({passed:!1,message:`Keyword density too high: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${e.keywordDensityMin}-${e.keywordDensityMax}% density`,severity:"warning"}):t.push({passed:!0,message:`Good keyword density: ${g.toFixed(1)}% (${c} uses in ${u} words)`,severity:"info"}),t}async function Y(o,a,e,t){var r;let s=[];if(!e.checkBrokenLinks)return[];let n=x(o),i=[...n.match(/\[\[([^\]]+)\]\]/g)||[],...n.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let l of i){let u="";if(l.startsWith("[["))u=(((r=l.match(/\[\[([^\]]+)\]\]/))==null?void 0:r[1])||"").split("|")[0];else{let c=l.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=l.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i),h=u.startsWith("/")&&!u.startsWith("//"),d=u.startsWith("#");if(e.publishMode&&(h||d)&&!g)continue;c||g?t!=null&&t.metadataCache.getFirstLinkpathDest(u,a.path)||s.push({passed:!1,message:`Broken link: ${u}`,suggestion:g?"Verify the image path exists or check if it's a relative path":"Check if the wikilink target exists or create the target note",severity:"error"}):t!=null&&t.vault.getAbstractFileByPath(u)||s.push({passed:!1,message:`Broken internal link: ${u}`,suggestion:"Check the link path or create the target file",severity:"error"})}}return s.length===0&&s.push({passed:!0,message:"No broken links found",severity:"info"}),s}async function J(o,a,e,t){var r;let s=[];if(!e.checkPotentiallyBrokenContent)return[];let n=x(o),i=[...n.match(/\[\[([^\]]+)\]\]/g)||[],...n.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let l of i){let u="";if(l.startsWith("[["))u=(((r=l.match(/\[\[([^\]]+)\]\]/))==null?void 0:r[1])||"").split("|")[0];else{let c=l.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=l.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i),h=u.startsWith("/")&&!u.startsWith("//"),d=u.startsWith("#");if(e.publishMode&&(h||d)&&!g){let k=d?"anchor link":"relative path";s.push({passed:!1,message:`Potentially broken link: ${u}`,suggestion:`${k.charAt(0).toUpperCase()+k.slice(1)} that may be resolved by your site generator. Verify the target will resolve on your published site.`,severity:"warning"});continue}(c||g)&&(t!=null&&t.metadataCache.getFirstLinkpathDest(u,a.path))&&c&&s.push({passed:!1,message:`Potentially broken link: ${u}`,suggestion:"Wikilinks may not work on the web - consider converting to standard markdown links",severity:"warning"})}}return s.length===0&&s.push({passed:!0,message:"No potentially broken links found",severity:"info"}),s}async function Q(o,a,e){let t=[];if(!e.descriptionProperty)return[];let s=o.match(/^---\n([\s\S]*?)\n---/);if(!s)return t.push({passed:!1,message:"No frontmatter found",suggestion:"Add frontmatter with description property",severity:"warning"}),t;let i=s[1].match(new RegExp(`^${e.descriptionProperty}:\\s*(.+)$`,"m"));if(!i)return t.push({passed:!1,message:`No ${e.descriptionProperty} found in frontmatter`,suggestion:`Add ${e.descriptionProperty} to frontmatter`,severity:"warning"}),t;let l=i[1].trim().length;return l<120?t.push({passed:!1,message:`Description too short: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):l>160?t.push({passed:!1,message:`Description too long: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):t.push({passed:!0,message:`Good description length: ${l} characters`,severity:"info"}),t}async function ee(o,a,e){let t=[];if(!e.checkTitleLength)return[];if(!e.titleProperty)return[];let s="";if(e.useFilenameAsTitle)s=a.basename;else{let i=o.match(/^---\n([\s\S]*?)\n---/);if(i){let l=i[1].match(new RegExp(`^${e.titleProperty}:\\s*(.+)$`,"m"));l&&(s=l[1].trim())}}if(!s)return[];let n=s.length;return n<30?t.push({passed:!1,message:`Title too short: ${n} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):n>60?t.push({passed:!1,message:`Title too long: ${n} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):t.push({passed:!0,message:`Good title length: ${n} characters`,severity:"info"}),t}async function te(o,a,e){let t=[];if(!e.checkContentLength)return[];let s=o.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/~~~[\s\S]*?~~~/g,"");let n=s.split(/\s+/).filter(i=>i.length>0).length;return n<e.minContentLength?t.push({passed:!1,message:`Content too short: ${n} words`,suggestion:`Aim for at least ${e.minContentLength} words for better SEO`,severity:"warning"}):t.push({passed:!0,message:`Good content length: ${n} words`,severity:"info"}),t}async function se(o,a,e){let t=[];if(!e.checkImageNaming)return[];let n=x(o).match(/!\[[^\]]*\]\(([^)]+)\)/g);return n&&n.forEach((i,r)=>{var u;let l=(u=i.match(/!\[[^\]]*\]\(([^)]+)\)/))==null?void 0:u[1];if(l){let c=l.split("/").pop()||"";c.includes(" ")||c.includes("%20")?t.push({passed:!1,message:`Image ${r+1} has spaces in filename: ${c}`,suggestion:"Use kebab-case or underscores instead of spaces",severity:"warning"}):c.match(/^[a-f0-9]{8,}$/)?t.push({passed:!1,message:`Image ${r+1} has random filename: ${c}`,suggestion:"Use descriptive file names",severity:"warning"}):c.toLowerCase().includes("pasted")||c.toLowerCase().includes("image")||c.toLowerCase().includes("untitled")||c.toLowerCase().includes("photo")||c.toLowerCase().includes("screenshot")&&(c.match(/[a-f0-9]{6,}/)||c.includes("_")||c.includes("-"))||c.match(/^screenshot\d*\.(png|jpg|jpeg|gif|webp)$/i)?t.push({passed:!1,message:`Image ${r+1} has a potentially generic file name: ${c}`,suggestion:"Use descriptive file names",severity:"warning"}):(c.length<5||c.length>50)&&t.push({passed:!1,message:`Image ${r+1} has inappropriate filename length: ${c}`,suggestion:"Use descriptive file names between 5-50 characters",severity:"warning"})}}),t.length===0&&t.push({passed:!0,message:"All images have good filenames",severity:"info"}),t}async function ne(o,a,e){let t=[];if(!e.checkDuplicateContent)return[];let s=globalThis.app;if(!s)return t;let n;if(e.scanDirectories.trim()){let c=e.scanDirectories.split(",").map(g=>g.trim());n=s.vault.getMarkdownFiles().filter(g=>c.some(h=>g.path.startsWith(h+"/")||g.path.startsWith(h+"\\")))}else n=s.vault.getMarkdownFiles();let i=n.filter(c=>c.path!==a.path);if(i.length===0)return t.push({passed:!0,message:"No other files to compare against",severity:"info"}),t;let l=x(o).split(`

`).filter(c=>c.trim().length>100).map(c=>c.trim().toLowerCase().replace(/\s+/g," "));if(l.length===0)return t.push({passed:!0,message:"No substantial content to check",severity:"info"}),t;let u=[];for(let c of l){let g=[];for(let h of i)try{let d=await s.vault.read(h);x(d).split(`

`).filter(m=>m.trim().length>100).map(m=>m.trim().toLowerCase().replace(/\s+/g," ")).includes(c)&&g.push(h.path)}catch(d){continue}g.length>0&&u.push({paragraph:c,duplicateFiles:g})}if(u.length>0){let c=u.length,g=[...new Set(u.flatMap(h=>h.duplicateFiles))];t.push({passed:!1,message:`Found ${c} paragraph(s) duplicated in other files`,suggestion:`Duplicate content found. Review and rewrite duplicate content to improve SEO.<br><br>${g.map(h=>`\u2022 ${h}`).join("<br>")}`,severity:"warning"})}else t.push({passed:!0,message:"No duplicate content found across vault",severity:"info"});return t}async function ie(o,a,e){let t=[];if(!e.checkReadingLevel)return[];let s=o.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/https?:\/\/[^\s]+/g,"").trim();let n=s.split(/[.!?]+/).filter(h=>h.trim().length>10),i=s.split(/\s+/).filter(h=>h.length>0&&/^[a-zA-Z]/.test(h)),r=i.reduce((h,d)=>h+be(d),0);if(n.length===0||i.length<10)return t.push({passed:!0,message:"Not enough content for reading level analysis",severity:"info"}),t;let l=i.length/n.length,u=r/i.length,c=206.835-1.015*l-84.6*u,g;return c>=90?g=5:c>=80?g=6:c>=70?g=7:c>=60?g=8:c>=50?g=9:c>=30?g=10:g=12,g>15?t.push({passed:!1,message:`Reading level too high: ${g.toFixed(1)} (Graduate level)`,suggestion:"Consider simplifying language for broader audience",severity:"warning"}):g<4?t.push({passed:!1,message:`Reading level too low: ${g.toFixed(1)} (Elementary level)`,suggestion:"Consider using more sophisticated language",severity:"warning"}):t.push({passed:!0,message:`Good reading level: ${g.toFixed(1)} (${Te(g)})`,severity:"info"}),t}async function ae(o,a,e){let t=[];if(!e.checkPotentiallyBrokenContent)return[];let s=[],n=o.match(/!\[[^\]]*\]\([^)]+\)/g);n&&s.push(...n.map(u=>{let c=u.match(/!\[[^\]]*\]\(([^)]+)\)/);return c?c[1]:u}));let i=o.match(/!\[\[([^\]]+)\]\]/g);i&&s.push(...i.map(u=>{let c=u.match(/!\[\[([^\]]+)\]\]/);return c?c[1]:u}));let r=o.match(/!\[[^\]]*\]\([^)]+\.(mp4|webm|ogg|mov|avi|mkv)(\?[^)]*)?\)/gi);r&&s.push(...r.map(u=>{let c=u.match(/!\[[^\]]*\]\(([^)]+)\)/);return c?c[1]:u}));let l=o.match(/!\[[^\]]*\]\([^)]+\.(mp3|wav|ogg|m4a|flac|aac)(\?[^)]*)?\)/gi);return l&&s.push(...l.map(u=>{let c=u.match(/!\[[^\]]*\]\(([^)]+)\)/);return c?c[1]:u})),s.length>0&&t.push({passed:!1,message:`Found ${s.length} embedded media file(s) that may not work on web publishing`,suggestion:`Verify these media files will be accessible on your published site:<br><br>${s.map(u=>`\u2022 ${u}`).join("<br>")}`,severity:"warning"}),t.length===0&&t.push({passed:!0,message:"No embedded media compatibility issues found",severity:"info"}),t}async function re(o,a,e){var l;let t=[];if(!e.keywordProperty.trim())return[];if(!e.slugProperty.trim()&&!e.useFilenameAsSlug)return[];let s=o.match(new RegExp(`^${e.keywordProperty}:\\s*(.+)$`,"m")),n=(l=s==null?void 0:s[1])==null?void 0:l.trim();if(!n)return[];(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1));let i=ce(a,o,e);return i?(i.toLowerCase().includes(n.toLowerCase())?t.push({passed:!0,message:`Keyword "${n}" found in slug`,severity:"info"}):t.push({passed:!1,message:`Keyword "${n}" not found in slug`,suggestion:`Consider including your target keyword in the slug for better SEO. Current slug: "${i}"`,severity:"warning"}),t):[]}async function oe(o,a,e){let t=[];if(!e.slugProperty.trim()&&!e.useFilenameAsSlug)return[];let s=ce(a,o,e);if(!s)return[];let n=[];return s.includes(" ")&&n.push("contains spaces"),s.toLowerCase().includes("untitled")&&n.push('contains "Untitled"'),s.match(/^[a-f0-9]{8,}$/i)&&n.push("appears to be a random string"),s.match(/[<>:"'|?*]/)&&n.push("contains illegal URL characters"),s.match(/[-_]{2,}/)&&n.push("has multiple consecutive separators"),n.length>0?t.push({passed:!1,message:`Slug format issues: ${n.join(", ")}`,suggestion:`Use kebab-case format (e.g., "my-awesome-post") or underscores (e.g., "my_awesome_post"). Current slug: "${s}"`,severity:"warning"}):t.push({passed:!0,message:"Slug format looks good",severity:"info"}),t}function le(o,a,e){if(e.useNoteTitles&&e.titleProperty.trim()){let t=a.match(/^---\n([\s\S]*?)\n---/);if(t){let n=t[1].match(new RegExp(`^${e.titleProperty}:\\s*(.+?)(?:\\n|$)`,"m"));if(n&&n[1].trim()){let i=n[1].trim();return(i.startsWith('"')&&i.endsWith('"')||i.startsWith("'")&&i.endsWith("'"))&&(i=i.slice(1,-1)),i}}}return o.basename}function ce(o,a,e){var t;if(e.useFilenameAsSlug){if(e.parentFolderSlugFilename.trim()&&o.basename.toLowerCase()===e.parentFolderSlugFilename.toLowerCase()){let s=o.path.split("/");if(s.length>1)return s[s.length-2]}return o.basename}else if(e.slugProperty.trim()){let s=a.match(new RegExp(`^${e.slugProperty}:\\s*(.+)$`,"m"));return((t=s==null?void 0:s[1])==null?void 0:t.trim())||""}return""}function be(o){if(o=o.toLowerCase(),o.length<=3)return 1;let a="aeiouy",e=0,t=!1;for(let s=0;s<o.length;s++){let n=a.includes(o[s]);n&&!t&&e++,t=n}return o.endsWith("e")&&e--,e===0&&(e=1),e}function Te(o){return o<6?"Elementary":o<8?"Middle School":o<10?"High School":o<12?"College Prep":"College"}async function ue(o,a,e){let t=[];if(!e.keywordProperty.trim())return[];let s="",n="",i=o.match(/^---\n([\s\S]*?)\n---/);if(i){let h=i[1].match(new RegExp(`^${e.keywordProperty}:\\s*(.+)$`,"m"));h&&(n=h[1].trim(),(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1)))}if(e.useFilenameAsTitle)s=a.basename;else if(e.titleProperty.trim()&&i){let h=i[1].match(new RegExp(`^${e.titleProperty}:\\s*(.+)$`,"m"));h&&(s=h[1].trim())}if(!s||!n)return[];let r=s.toLowerCase();return n.toLowerCase().split(/\s+/).filter(g=>g.length>0).every(g=>r.includes(g))?t.push({passed:!0,message:`Target keyword "${n}" found in title`,severity:"info"}):t.push({passed:!1,message:`Target keyword "${n}" not found in title`,suggestion:"Include your target keyword in the title for better SEO",severity:"warning"}),t}var ge=B(()=>{});var E={};G(E,{clearAllCache:()=>De,clearCache:()=>Ne,clearCacheForFile:()=>Ae,getCacheStats:()=>$e,runSEOCheck:()=>xe});async function xe(o,a){let e=[];for(let t of a)try{let s=Le(t,o);if(s){e.push(s);continue}let n=await o.app.vault.read(t),i=await Fe(o,t,n);Re(t,i,o),e.push(i)}catch(s){console.error(`Error checking file ${t.path}:`,s)}return e}async function Fe(o,a,e){let t={titleLength:await ee(e,a,o.settings),metaDescription:await Q(e,a,o.settings),keywordInTitle:await ue(e,a,o.settings),keywordInSlug:await re(e,a,o.settings),slugFormat:await oe(e,a,o.settings),keywordDensity:await X(e,a,o.settings),headingOrder:await Z(e,a,o.settings),contentLength:await te(e,a,o.settings),duplicateContent:await ne(e,a,o.settings),altText:await z(e,a,o.settings),imageNaming:await se(e,a,o.settings),brokenLinks:await Y(e,a,o.settings,o.app),nakedLinks:await _(e,a,o.settings),readingLevel:await ie(e,a,o.settings),potentiallyBrokenLinks:await J(e,a,o.settings,o.app),potentiallyBrokenEmbeds:await ae(e,a,o.settings)},s=Object.values(t).flat(),n=s.filter(l=>l.severity==="error").length,i=s.filter(l=>l.severity==="warning").length,r;if(s.length===0)r=100;else{let l=0,u=0;s.forEach(p=>{let m=1,y=0;p.message.includes("Broken link")&&!p.passed||p.message.includes("title")&&!p.passed?(m=10,y=0):p.message.includes("alt text")&&!p.passed||p.message.includes("meta description")&&!p.passed?(m=5,y=0):p.message.includes("content length")&&!p.passed||p.message.includes("reading level")&&!p.passed?(m=3,y=0):p.severity==="warning"&&!p.passed?(m=1,y=0):p.passed&&(y=100),l+=y*m,u+=m});let c=u>0?l/u:100,g=0,h=s.filter(p=>p.severity==="error"&&!p.passed&&p.message.includes("Broken link")).length;g+=Math.min(h*2,10);let d=s.filter(p=>p.severity==="error"&&!p.passed&&p.message.includes("alt text")).length;g+=Math.min(d*1,5);let k=s.filter(p=>p.severity==="warning"&&!p.passed).length;g+=Math.min(k*.5,5),g=Math.min(g,20),r=Math.max(40,Math.min(100,c-g))}return{file:a.path,displayName:le(a,e,o.settings),checks:t,overallScore:r,issuesCount:n,warningsCount:i}}async function Oe(o,a){try{let e=await a.vault.read(o),t=await a.vault.adapter.stat(o.path);return`${e.length}-${t.mtime}`}catch(e){return`${Date.now()}`}}function he(o){let a={keywordProperty:o.keywordProperty||"",keywordDensityMin:o.keywordDensityMin,keywordDensityMax:o.keywordDensityMax,descriptionProperty:o.descriptionProperty||"",titleProperty:o.titleProperty||"",useFilenameAsTitle:o.useFilenameAsTitle,checkContentLength:o.checkContentLength,minContentLength:o.minContentLength,checkDuplicateContent:o.checkDuplicateContent,scanDirectories:o.scanDirectories||""};return JSON.stringify(a)}function Le(o,a){let e=P.get(o.path);if(!e)return null;let s=Date.now()-e.timestamp>Pe,n=he(a.settings),i=e.settingsHash!==n;return s||i?(P.delete(o.path),null):e.result}async function Re(o,a,e){let t=await Oe(o,e.app),s=he(e.settings);P.set(o.path,{result:a,timestamp:Date.now(),fileHash:t,settingsHash:s})}function Ne(){P.clear()}function $e(){return{size:P.size}}function Ae(o){P.delete(o)}function De(){P.clear()}var P,Pe,b=B(()=>{ge();P=new Map,Pe=24*60*60*1e3});var Me={};G(Me,{default:()=>H});module.exports=ve(Me);var de=require("obsidian");var j={scanDirectories:"",keywordProperty:"",descriptionProperty:"",titleProperty:"",useFilenameAsTitle:!1,slugProperty:"",useFilenameAsSlug:!1,parentFolderSlugFilename:"",checkTitleLength:!0,checkHeadingOrder:!0,checkAltText:!0,checkImageNaming:!0,checkBrokenLinks:!0,checkNakedLinks:!0,checkContentLength:!0,checkDuplicateContent:!1,checkReadingLevel:!0,checkPotentiallyBrokenContent:!0,useNoteTitles:!1,publishMode:!1,defaultSort:"issues-desc",minContentLength:300,keywordDensityMin:1,keywordDensityMax:2,duplicateThreshold:80,cachedGlobalResults:[],lastScanTimestamp:0};var Se=require("obsidian");function U(o){o.addCommand({id:"seo-open-current",name:"Open current note audit",callback:async()=>{o.openCurrentPanel(),setTimeout(async()=>{let a=o.app.workspace.getLeavesOfType("seo-current-panel")[0];if(a&&a.view){let e=a.view.containerEl.querySelector(".seo-top-btn");e&&e.click()}},200)}}),o.addCommand({id:"seo-open-global",name:"Open vault audit",callback:async()=>{let e=o.app.workspace.getLeavesOfType("seo-global-panel").length===0;o.openGlobalPanel(),setTimeout(async()=>{let t=o.app.workspace.getLeavesOfType("seo-global-panel");if(t.length===0){o.openGlobalPanel();return}let s=t[0];if(s.view){let n=s.view;e?(o.app.workspace.revealLeaf(s),o.app.workspace.setActiveLeaf(s)):(await n.actions.refreshGlobalResults(),n.render())}},300)}})}var f=require("obsidian"),N=class extends f.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Global"}),new f.Setting(e).setName("Scan directories").setDesc("Comma-separated list of directory names to scan. Leave blank to scan all directories.").addText(i=>i.setPlaceholder("e.g., blog, posts, public").setValue(this.plugin.settings.scanDirectories).onChange(async r=>{this.plugin.settings.scanDirectories=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Use note titles instead of file names").setDesc("Display note titles from frontmatter instead of file names in the issues list and current note audit").addToggle(i=>i.setValue(this.plugin.settings.useNoteTitles).onChange(async r=>{this.plugin.settings.useNoteTitles=r,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Property Names"}),new f.Setting(e).setName("Keyword property").setDesc("Property name for target keyword (e.g., targetKeyword, seo, keyword)").addText(i=>i.setPlaceholder("targetKeyword").setValue(this.plugin.settings.keywordProperty).onChange(async r=>{this.plugin.settings.keywordProperty=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Description property").setDesc("Property name for meta description").addText(i=>i.setPlaceholder("description").setValue(this.plugin.settings.descriptionProperty).onChange(async r=>{this.plugin.settings.descriptionProperty=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Title property").setDesc("Property name for title (leave blank to skip title checks)").addText(i=>i.setPlaceholder("title").setValue(this.plugin.settings.titleProperty).onChange(async r=>{this.plugin.settings.titleProperty=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Use file name as title").setDesc("Use file name as title instead of a property").addToggle(i=>i.setValue(this.plugin.settings.useFilenameAsTitle).onChange(async r=>{this.plugin.settings.useFilenameAsTitle=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Slug property").setDesc("Property name for slug (leave blank to skip slug checks)").addText(i=>i.setPlaceholder("slug").setValue(this.plugin.settings.slugProperty).onChange(async r=>{this.plugin.settings.slugProperty=r,await this.plugin.saveSettings()}));let t=new f.Setting(e).setName("Use file/folder name as slug").setDesc("Use file/folder name as slug instead of a property").addToggle(i=>i.setValue(this.plugin.settings.useFilenameAsSlug).onChange(async r=>{this.plugin.settings.useFilenameAsSlug=r,await this.plugin.saveSettings(),this.display()}));this.plugin.settings.useFilenameAsSlug&&new f.Setting(e).setName("Use parent folder name instead when specified file name is used").setDesc("If a markdown file matches this file name, use the parent folder name as the slug instead").addText(i=>i.setPlaceholder("index").setValue(this.plugin.settings.parentFolderSlugFilename).onChange(async r=>{this.plugin.settings.parentFolderSlugFilename=r,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Check Options"}),new f.Setting(e).setName("Check title length").setDesc("Enable title length checking").addToggle(i=>i.setValue(this.plugin.settings.checkTitleLength).onChange(async r=>{this.plugin.settings.checkTitleLength=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check heading order").setDesc("Enable heading hierarchy checking").addToggle(i=>i.setValue(this.plugin.settings.checkHeadingOrder).onChange(async r=>{this.plugin.settings.checkHeadingOrder=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check content length").setDesc("Enable content length checking").addToggle(i=>i.setValue(this.plugin.settings.checkContentLength).onChange(async r=>{this.plugin.settings.checkContentLength=r,await this.plugin.saveSettings()}));let n=new f.Setting(e).setName("Check duplicate content").setDesc("Enable duplicate content detection").addToggle(i=>i.setValue(this.plugin.settings.checkDuplicateContent).onChange(async r=>{this.plugin.settings.checkDuplicateContent=r,await this.plugin.saveSettings()})).descEl.createEl("div",{text:"\u26A0\uFE0F WARNING: This feature can be very resource-intensive with large vaults and many notes. Disable for faster audits.",cls:"setting-item-description"});n.style.color="#ff6b6b",n.style.fontWeight="bold",n.style.marginTop="4px",new f.Setting(e).setName("Check alt text").setDesc("Enable alt text checking for images").addToggle(i=>i.setValue(this.plugin.settings.checkAltText).onChange(async r=>{this.plugin.settings.checkAltText=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check image file names").setDesc("Enable image filename checking").addToggle(i=>i.setValue(this.plugin.settings.checkImageNaming).onChange(async r=>{this.plugin.settings.checkImageNaming=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check broken links").setDesc("Enable broken link detection").addToggle(i=>i.setValue(this.plugin.settings.checkBrokenLinks).onChange(async r=>{this.plugin.settings.checkBrokenLinks=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check naked links").setDesc("Enable naked URL detection").addToggle(i=>i.setValue(this.plugin.settings.checkNakedLinks).onChange(async r=>{this.plugin.settings.checkNakedLinks=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check reading level").setDesc("Enable reading level analysis").addToggle(i=>i.setValue(this.plugin.settings.checkReadingLevel).onChange(async r=>{this.plugin.settings.checkReadingLevel=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Check potentially broken content").setDesc("Check for potentially broken markdown or wikilink-based embedded media that may not work on web publishing").addToggle(i=>i.setValue(this.plugin.settings.checkPotentiallyBrokenContent).onChange(async r=>{this.plugin.settings.checkPotentiallyBrokenContent=r,await this.plugin.saveSettings()})),new f.Setting(e).setName("Flexible relative link check").setDesc("Uses flexible validation for relative paths like /page that can be resolved by a static site generator, but may be considered broken by typical Obsidian validation").addToggle(i=>i.setValue(this.plugin.settings.publishMode).onChange(async r=>{this.plugin.settings.publishMode=r,await this.plugin.saveSettings()})),e.createEl("h2",{text:"Thresholds"}),new f.Setting(e).setName("Minimum content length").setDesc("Minimum word count for content length check").addText(i=>i.setPlaceholder("300").setValue(this.plugin.settings.minContentLength.toString()).onChange(async r=>{let l=parseInt(r);isNaN(l)||(this.plugin.settings.minContentLength=l,await this.plugin.saveSettings())})),new f.Setting(e).setName("Keyword density minimum").setDesc("Minimum keyword density percentage").addText(i=>i.setPlaceholder("1").setValue(this.plugin.settings.keywordDensityMin.toString()).onChange(async r=>{let l=parseFloat(r);isNaN(l)||(this.plugin.settings.keywordDensityMin=l,await this.plugin.saveSettings())})),new f.Setting(e).setName("Keyword density maximum").setDesc("Maximum keyword density percentage").addText(i=>i.setPlaceholder("2").setValue(this.plugin.settings.keywordDensityMax.toString()).onChange(async r=>{let l=parseFloat(r);isNaN(l)||(this.plugin.settings.keywordDensityMax=l,await this.plugin.saveSettings())})),new f.Setting(e).setName("Duplicate content threshold").setDesc("Similarity percentage threshold for duplicate content detection").addText(i=>i.setPlaceholder("80").setValue(this.plugin.settings.duplicateThreshold.toString()).onChange(async r=>{let l=parseInt(r);isNaN(l)||(this.plugin.settings.duplicateThreshold=l,await this.plugin.saveSettings())}))}};var D=require("obsidian");var S="seo-current-panel",T="seo-global-panel";function K(o){let a=o.split("/");return a.length<=2?o:a.slice(-2).join("/")}function V(o){return!o||o.trim()===""?"Vault folders: all":`Vault folders: ${o.split(",").map(e=>e.trim()).filter(e=>e.length>0).join(", ")}`}function q(o,a){let e=[...o];switch(a){case"warnings-desc":e.sort((t,s)=>s.warningsCount!==t.warningsCount?s.warningsCount-t.warningsCount:s.issuesCount!==t.issuesCount?s.issuesCount-t.issuesCount:t.file.localeCompare(s.file));break;case"warnings-asc":e.sort((t,s)=>t.warningsCount!==s.warningsCount?t.warningsCount-s.warningsCount:t.issuesCount!==s.issuesCount?t.issuesCount-s.issuesCount:t.file.localeCompare(s.file));break;case"issues-desc":e.sort((t,s)=>s.issuesCount!==t.issuesCount?s.issuesCount-t.issuesCount:s.warningsCount!==t.warningsCount?s.warningsCount-t.warningsCount:t.file.localeCompare(s.file));break;case"issues-asc":e.sort((t,s)=>t.issuesCount!==s.issuesCount?t.issuesCount-s.issuesCount:t.warningsCount!==s.warningsCount?t.warningsCount-s.warningsCount:t.file.localeCompare(s.file));break;case"filename-asc":e.sort((t,s)=>t.file.localeCompare(s.file));break;case"filename-desc":e.sort((t,s)=>s.file.localeCompare(t.file));break}return e}var C=require("obsidian");var $=class{constructor(a,e,t){this.app=a;this.plugin=e;this.panelType=t}async runInitialScan(){try{let a=await this.plugin.getFilesToCheck();if(a.length===0)return[];a.length>20&&new C.Notice(`Running SEO audit on ${a.length} files... This may take a moment.`);let{runSEOCheck:e}=await Promise.resolve().then(()=>(b(),E)),t=await e(this.plugin,a);return this.plugin.settings.cachedGlobalResults=t,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new C.Notice(`SEO audit complete with ${t.length} files.`),t}catch(a){return console.error("Error running initial scan:",a),new C.Notice("Error analyzing files. Check console for details."),[]}}async checkCurrentNote(){let a=this.app.workspace.getActiveFile();if(!a||!a.path.endsWith(".md"))return new C.Notice("Please open a markdown file first."),null;try{let{clearCacheForFile:e}=await Promise.resolve().then(()=>(b(),E));e(a.path);let{runSEOCheck:t}=await Promise.resolve().then(()=>(b(),E)),s=await t(this.plugin,[a]);return s.length>0?(new C.Notice("SEO audit complete."),s[0]):null}catch(e){return console.error("Error checking current note:",e),new C.Notice("Error analyzing current note. Check console for details."),null}}async refreshGlobalResults(){try{let{clearAllCache:a}=await Promise.resolve().then(()=>(b(),E));a();let e=await this.plugin.getFilesToCheck();if(e.length===0)return new C.Notice("No markdown files found in configured directories."),[];e.length>20&&new C.Notice(`Refreshing SEO audit on ${e.length} files... This may take a moment.`);let{runSEOCheck:t}=await Promise.resolve().then(()=>(b(),E)),s=await t(this.plugin,e);return this.plugin.settings.cachedGlobalResults=s,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new C.Notice(`SEO audit complete with ${s.length} files.`),s}catch(a){return console.error("Error checking all notes:",a),new C.Notice("Error analyzing files. Check console for details."),[]}}async openFile(a){try{let e=this.app.vault.getAbstractFileByPath(a);if(e)try{await this.app.workspace.getLeaf().openFile(e)}catch(t){await this.app.workspace.openLinkText(a,"",!0)}}catch(e){console.error(`Error opening file ${a}:`,e)}}async openFileAndAudit(a){let e=this.app.vault.getAbstractFileByPath(a);e&&(await this.app.workspace.getLeaf().openFile(e),this.plugin.openCurrentPanel(),setTimeout(()=>{let t=this.app.workspace.getLeavesOfType(S)[0];if(t){let s=t.view.containerEl.querySelector(".seo-top-btn");s&&s.click()}},200))}showSortMenu(a,e,t,s,n){let i=new C.Menu;i.addItem(r=>{r.setTitle("Issues (high to low)").onClick(()=>{n("issues-desc"),this.sortAndRenderFiles(e,t,"issues-desc")}),s==="issues-desc"&&r.setIcon("check")}),i.addItem(r=>{r.setTitle("Issues (low to high)").onClick(()=>{n("issues-asc"),this.sortAndRenderFiles(e,t,"issues-asc")}),s==="issues-asc"&&r.setIcon("check")}),i.addSeparator(),i.addItem(r=>{r.setTitle("Warnings (high to low)").onClick(()=>{n("warnings-desc"),this.sortAndRenderFiles(e,t,"warnings-desc")}),s==="warnings-desc"&&r.setIcon("check")}),i.addItem(r=>{r.setTitle("Warnings (low to high)").onClick(()=>{n("warnings-asc"),this.sortAndRenderFiles(e,t,"warnings-asc")}),s==="warnings-asc"&&r.setIcon("check")}),i.addSeparator(),i.addItem(r=>{r.setTitle("File name (A to Z)").onClick(()=>{n("filename-asc"),this.sortAndRenderFiles(e,t,"filename-asc")}),s==="filename-asc"&&r.setIcon("check")}),i.addItem(r=>{r.setTitle("File name (Z to A)").onClick(()=>{n("filename-desc"),this.sortAndRenderFiles(e,t,"filename-desc")}),s==="filename-desc"&&r.setIcon("check")}),i.showAtPosition({x:a.clientX,y:a.clientY})}sortAndRenderFiles(a,e,t){let s=q([...a],t),n=e.querySelector(".seo-files-list-container");n&&(n.querySelectorAll(".seo-file-issue").forEach(i=>i.remove()),this.renderFilesList(s,n))}renderFilesList(a,e){a.forEach(t=>{let s=e.createEl("div",{cls:"seo-file-issue"});s.setAttribute("data-file-path",t.file),s.createEl("a",{text:t.displayName||this.getDisplayPath(t.file),cls:"seo-file-link",href:"#"}).addEventListener("click",l=>{l.preventDefault(),this.openFile(t.file)});let i=s.createEl("div",{cls:"seo-stats-container"});i.createEl("span",{text:`${t.issuesCount} issues, ${t.warningsCount} warnings`,cls:"seo-file-stats"});let r=i.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,C.setIcon)(r,"search-check"),r.addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation(),await this.openFileAndAudit(t.file)})})}getDisplayPath(a){let e=a.split("/");return e.length<=2?a:e.slice(-2).join("/")}};var F=require("obsidian");var A=class{constructor(a,e,t){this.container=a;this.onFileClick=e;this.onFileAudit=t;this.isCollapsed=!0}renderResults(a){let e=this.container.createEl("div",{cls:"seo-score-header"}),t=e.createEl("div",{cls:"seo-score-text"});t.createEl("span",{text:"Score: "});let s=t.createEl("span",{text:`${Math.round(a.overallScore)}%`});if(a.overallScore>=80?s.addClass("seo-score-excellent"):a.overallScore>=60?s.addClass("seo-score-good"):a.overallScore>=40?s.addClass("seo-score-fair"):s.addClass("seo-score-poor"),a.issuesCount>0||a.warningsCount>0){t.createEl("span",{text:" ("});let r=t.createEl("span",{text:`${a.issuesCount} issues`,cls:"seo-issues-count-text"});t.createEl("span",{text:", "});let l=t.createEl("span",{text:`${a.warningsCount} warnings`,cls:"seo-warnings-count-text"});t.createEl("span",{text:")"})}else t.createEl("span",{text:" (All checks passed!)",cls:"seo-success"});let n=e.createEl("div",{cls:"seo-toggle-icon"});(0,F.setIcon)(n,"chevrons-down-up"),n.addEventListener("click",()=>{this.isCollapsed=!this.isCollapsed,(0,F.setIcon)(n,this.isCollapsed?"chevrons-up-down":"chevrons-down-up"),this.toggleChecksVisibility()});let i=this.container.createEl("div",{cls:"seo-checks"});this.isCollapsed=!1,Object.entries(a.checks).forEach(([r,l])=>{if(l.length===0)return;let u=l.some(w=>w.severity==="error"),c=l.some(w=>w.severity==="warning"),g=l.every(w=>w.severity==="info"),h="seo-passed";u?h="seo-error":c?h="seo-warning":g&&(h="seo-passed");let d=i.createEl("div",{cls:`seo-check ${h}`}),k=d.createEl("div",{cls:"seo-check-header seo-collapsible-header"}),p=r.replace(/([A-Z])/g," $1").trim().replace(/^./,w=>w.toUpperCase()),m=k.createEl("span",{cls:"seo-collapse-icon"});m.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',k.createEl("span",{text:p});let y=k.createEl("span",{cls:"seo-status"}),fe=l.some(w=>w.severity==="error"),me=l.some(w=>w.severity==="warning");fe?y.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>':me?y.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>':y.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>';let O=d.createEl("ul",{cls:"seo-results"});O.style.display="block",l.forEach(w=>{let L=O.createEl("li",{cls:`seo-result seo-${w.severity}`,text:w.message});if(w.suggestion){let R=L.createEl("div",{cls:"seo-suggestion"});R.innerHTML=w.suggestion}}),k.addEventListener("click",()=>{let w=O.style.display==="none";O.style.display=w?"block":"none";let L=m.querySelector("svg");if(L&&(L.style.transform=w?"rotate(0deg)":"rotate(-90deg)"),w){this.isCollapsed=!1;let R=this.container.querySelector(".seo-toggle-icon");R&&(0,F.setIcon)(R,"chevrons-down-up")}})})}renderGlobalResults(a){let e=this.container.createEl("div",{cls:"seo-vault-summary"}),t=a.length,s=a.reduce((m,y)=>m+y.issuesCount,0),n=a.reduce((m,y)=>m+y.warningsCount,0),i=Math.round(a.reduce((m,y)=>m+y.overallScore,0)/t),r=e.createEl("div",{cls:"seo-stats-grid"}),l=r.createEl("div",{cls:"seo-stat-item"});l.createEl("div",{cls:"seo-stat-number",text:t.toString()}),l.createEl("div",{cls:"seo-stat-label",text:"Files analyzed"});let u=r.createEl("div",{cls:"seo-stat-item"}),c=u.createEl("div",{cls:"seo-stat-number",text:`${i}%`}),g="Average score";i>=80?(c.addClass("seo-score-excellent"),g="Excellent"):i>=60?(c.addClass("seo-score-good"),g="Good"):i>=40?(c.addClass("seo-score-fair"),g="Fair"):(c.addClass("seo-score-poor"),g="Poor"),u.createEl("div",{cls:"seo-stat-label",text:g});let h=r.createEl("div",{cls:"seo-stat-item"}),d=h.createEl("div",{cls:"seo-stat-number",text:s.toString()});s>0&&d.addClass("seo-issues-count"),h.createEl("div",{cls:"seo-stat-label",text:"Issues"});let k=r.createEl("div",{cls:"seo-stat-item"}),p=k.createEl("div",{cls:"seo-stat-number",text:n.toString()});n>0&&p.addClass("seo-warnings-count"),k.createEl("div",{cls:"seo-stat-label",text:"Warnings"})}renderIssuesList(a,e,t,s){let n=a.filter(h=>h.issuesCount>0||h.warningsCount>0);if(n.length===0)return;let i=this.container.createEl("div",{cls:"seo-issues-list"}),r=i.createEl("div",{cls:"seo-issues-header-container"}),l=r.createEl("span",{cls:"seo-collapse-icon seo-collapsible-header"});l.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',r.createEl("h4",{text:"Files with issues",cls:"seo-issues-header"});let u=r.createEl("button",{cls:"seo-sort-btn",attr:{"aria-label":"Sort files"}});(0,F.setIcon)(u,"arrow-up-narrow-wide"),u.addEventListener("click",s);let c=i.createEl("div",{cls:"seo-files-list-container"});this.sortFiles(n,e).forEach(h=>{let d=c.createEl("div",{cls:"seo-file-issue"});d.setAttribute("data-file-path",h.file),d.createEl("a",{text:h.displayName||K(h.file),cls:"seo-file-link",href:"#"}).addEventListener("click",async y=>{y.preventDefault(),await this.onFileClick(h.file)});let p=d.createEl("div",{cls:"seo-stats-container"});p.createEl("span",{text:`${h.issuesCount} issues, ${h.warningsCount} warnings`,cls:"seo-file-stats"});let m=p.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,F.setIcon)(m,"search-check"),m.addEventListener("click",async y=>{y.preventDefault(),y.stopPropagation(),await this.onFileAudit(h.file)})}),l.addEventListener("click",h=>{let d=c.style.display==="none";c.style.display=d?"block":"none";let k=l.querySelector("svg");k&&(k.style.transform=d?"rotate(0deg)":"rotate(-90deg)")})}sortFiles(a,e){let t=[...a];switch(e){case"warnings-desc":t.sort((s,n)=>{let i=n.warningsCount-s.warningsCount;if(i!==0)return i;let r=n.issuesCount-s.issuesCount;if(r!==0)return r;let l=s.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"warnings-asc":t.sort((s,n)=>{let i=s.warningsCount-n.warningsCount;if(i!==0)return i;let r=s.issuesCount-n.issuesCount;if(r!==0)return r;let l=s.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-desc":t.sort((s,n)=>{let i=n.issuesCount-s.issuesCount;if(i!==0)return i;let r=n.warningsCount-s.warningsCount;if(r!==0)return r;let l=s.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-asc":t.sort((s,n)=>{let i=s.issuesCount-n.issuesCount;if(i!==0)return i;let r=s.warningsCount-n.warningsCount;if(r!==0)return r;let l=s.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"filename-asc":t.sort((s,n)=>{let i=s.file.split("/").pop()||"",r=n.file.split("/").pop()||"",l=i.localeCompare(r);return l!==0?l:s.file.localeCompare(n.file)});break;case"filename-desc":t.sort((s,n)=>{let i=s.file.split("/").pop()||"",l=(n.file.split("/").pop()||"").localeCompare(i);return l!==0?l:n.file.localeCompare(s.file)});break}return t}toggleChecksVisibility(){let a=this.container.querySelector(".seo-checks");if(!a)return;a.querySelectorAll(".seo-check-header").forEach(t=>{var r;let s=t,n=(r=s.parentElement)==null?void 0:r.querySelector(".seo-results"),i=s.querySelector(".seo-collapse-icon svg");n&&i&&(this.isCollapsed?(n.style.display="none",i.style.transform="rotate(-90deg)"):(n.style.display="block",i.style.transform="rotate(0deg)"))})}};var v=class extends D.ItemView{constructor(e,t="current",s){super(s||e.app.workspace.getLeaf());this.currentNoteResults=null;this.globalResults=[];this.panelType="current";this.hasRunInitialScan=!1;this.plugin=e,this.panelType=t,this.currentSort=e.settings.defaultSort,this.actions=new $(this.app,this.plugin,this.panelType),this.resultsDisplay=new A(this.containerEl,async n=>await this.actions.openFile(n),async n=>await this.actions.openFileAndAudit(n))}getViewType(){return this.panelType==="current"?S:T}getDisplayText(){return this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}getIcon(){return"search-check"}async onOpen(){try{this.panelType==="global"&&this.plugin.settings.cachedGlobalResults.length>0&&(this.globalResults=this.plugin.settings.cachedGlobalResults),this.forceIconRefresh(),this.panelType==="global"&&!this.hasRunInitialScan&&this.globalResults.length===0?(this.showLoadingState(),this.hasRunInitialScan=!0,await this.runInitialScan()):this.render()}catch(e){console.error("Error opening SEO panel:",e)}}async onClose(){}cleanup(){}async runInitialScan(){let e=await this.actions.runInitialScan();e.length>0&&(this.globalResults=e,this.render())}forceIconRefresh(){this.leaf&&this.leaf.setViewState({type:this.getViewType(),state:this.leaf.view.getState()}),setTimeout(()=>{let e=this.containerEl.querySelector(".view-header-icon");e&&(e.innerHTML="",e.setAttribute("data-icon","search-check"),e.setAttribute("data-icon",""),e.offsetHeight,e.setAttribute("data-icon","search-check"));let t=this.containerEl.querySelector(".view-header");t&&(t.style.display="none",t.offsetHeight,t.style.display=""),this.app.workspace.trigger("layout-change")},50)}async updateCurrentNoteResults(e){if(!(!e||!e.path.endsWith(".md")))try{let t=await this.app.vault.read(e);this.render()}catch(t){console.error("Error updating current note results:",t)}}async updateResults(e){this.globalResults=e,this.render()}showLoadingState(){let{containerEl:e}=this;e.empty(),e.addClass("seo-panel");let t=e.createEl("div",{cls:"seo-panel-header"});if(t.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="global"){let i=V(this.plugin.settings.scanDirectories),r=t.createEl("div",{cls:"seo-filename"});r.textContent=i}let s=e.createEl("div",{cls:"seo-loading-container"}),n=s.createEl("div",{cls:"seo-loading-spinner"});(0,D.setIcon)(n,"loader-circle"),s.createEl("h3",{text:"Running SEO audit...",cls:"seo-loading-title"}),s.createEl("p",{text:"This may take a moment for large vaults. Please wait...",cls:"seo-loading-message"})}render(){var e;try{let{containerEl:t}=this;t.empty(),t.addClass("seo-panel");let s=t.createEl("div",{cls:"seo-panel-header"});if(s.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="current"){let n=this.app.workspace.getActiveFile();if(n&&n.path.endsWith(".md")){let i=s.createEl("div",{cls:"seo-filename"}),r=((e=this.currentNoteResults)==null?void 0:e.displayName)||n.path;i.textContent=`Target note: ${r}`}}else{let n=V(this.plugin.settings.scanDirectories),i=s.createEl("div",{cls:"seo-filename"});i.textContent=n}if(this.panelType==="current"){let n=t.createEl("button",{text:"Audit current note",cls:"mod-cta seo-btn seo-top-btn"});n.addEventListener("click",async()=>{let i=n.textContent;n.disabled=!0,n.style.opacity="0.7";try{let r=await this.actions.checkCurrentNote();r&&(this.currentNoteResults=r,this.updateGlobalResultsIfExists(r),this.render())}finally{n.disabled=!1,n.style.opacity="1"}})}this.panelType==="current"?this.currentNoteResults?this.resultsDisplay.renderResults(this.currentNoteResults):t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Audit current note" to audit it.'}):this.globalResults.length>0?this.renderGlobalResults(t):t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Click "Audit all notes" to audit your files in your configured directories.'})}catch(t){console.error("Error rendering SEO panel:",t),this.containerEl.createEl("div",{text:"Error loading SEO panel. Please try again."})}}updateGlobalResultsIfExists(e){if(this.plugin.settings.cachedGlobalResults&&this.plugin.settings.cachedGlobalResults.length>0){let t=this.plugin.settings.cachedGlobalResults,s=t.findIndex(n=>n.file===e.file);s!==-1?t[s]=e:t.push(e),this.plugin.saveSettings(),this.updateGlobalPanelIfOpen()}}updateGlobalPanelIfOpen(){let e=this.app.workspace.getLeavesOfType("seo-global-panel");if(e.length>0){let t=e[0];if(t.view){let s=t.view;s.globalResults=[...this.plugin.settings.cachedGlobalResults],s.render()}}}renderGlobalResults(e){this.resultsDisplay.renderGlobalResults(this.globalResults);let t=e.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-refresh-btn"});t.addEventListener("click",async()=>{t.textContent="Refreshing...",t.disabled=!0;try{let s=await this.actions.refreshGlobalResults();s.length>0&&(this.globalResults=s,this.render())}finally{t.textContent="Refresh",t.disabled=!1}}),this.resultsDisplay.renderIssuesList(this.globalResults,this.currentSort,s=>{this.currentSort=s,this.plugin.settings.defaultSort=s,this.plugin.saveSettings()},s=>{let n=this.globalResults.filter(i=>i.issuesCount>0||i.warningsCount>0);this.actions.showSortMenu(s,n,e,this.currentSort,i=>{this.currentSort=i,this.plugin.settings.defaultSort=i,this.plugin.saveSettings()})})}};var pe=require("obsidian");var M=class{constructor(a,e){this.app=a;this.plugin=e}openCurrentPanel(){this.openPanel(S,"current")}openGlobalPanel(){this.openPanel(T,"global")}openPanel(a,e){let t=this.app.workspace.getLeavesOfType(a)[0];if(t)this.app.workspace.revealLeaf(t),this.app.workspace.setActiveLeaf(t),t.view instanceof v&&setTimeout(()=>t.view.forceIconRefresh(),100);else{let s=this.app.workspace.getRightLeaf(!1);if(s){let n=new v(this.plugin,e,s);s.open(n),this.app.workspace.setActiveLeaf(s),setTimeout(()=>{s.view instanceof v&&s.view.forceIconRefresh()},100)}}}async getFilesToCheck(){let{vault:a}=this.app,{scanDirectories:e}=this.plugin.settings;if(!e.trim())return a.getMarkdownFiles();let t=e.split(",").map(n=>n.trim()),s=[];for(let n of t){let i=a.getAbstractFileByPath(n);i&&i instanceof pe.TFolder&&s.push(...a.getMarkdownFiles().filter(r=>r.path.startsWith(n+"/")||r.path===n))}return s}};var I=class{constructor(a,e){this.app=a;this.plugin=e;this.timeoutId=null}registerRealTimeChecking(){this.plugin.registerEvent(this.app.workspace.on("editor-change",()=>{this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.checkCurrentNote()},2e3)}))}async checkCurrentNote(){let a=this.app.workspace.getActiveFile();if(!(!a||!a.path.endsWith(".md")))try{let{runSEOCheck:e}=await Promise.resolve().then(()=>(b(),E)),t=await e(this.plugin,[a])}catch(e){console.error("Error checking current note:",e)}}async runBulkCheck(){let{runSEOCheck:a}=await Promise.resolve().then(()=>(b(),E)),e=await this.plugin.getFilesToCheck();if(e.length!==0)try{let t=await a(this.plugin,e)}catch(t){console.error("Error running bulk check:",t)}}};var H=class extends de.Plugin{async onload(){await this.loadSettings(),this.panelManager=new M(this.app,this),this.realTimeChecker=new I(this.app,this),this.forceIconRefresh(),this.registerView(S,e=>new v(this,"current",e)),this.registerView(T,e=>new v(this,"global",e)),U(this),this.addSettingTab(new N(this.app,this)),this.realTimeChecker.registerRealTimeChecking(),this.addRibbonIcon("search-check","Open SEO audit panel",async()=>{let t=this.app.workspace.getLeavesOfType("seo-global-panel").length===0;this.openGlobalPanel(),t||setTimeout(async()=>{let s=this.app.workspace.getLeavesOfType("seo-global-panel");if(s.length>0){let n=s[0];if(n.view){let i=n.view;await i.actions.refreshGlobalResults(),i.render()}}},500)})}onunload(){}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings);let{clearAllCache:e}=await Promise.resolve().then(()=>(b(),E));e()}addStatusBar(){}removeStatusBar(){}openCurrentPanel(){this.panelManager.openCurrentPanel()}openGlobalPanel(){this.panelManager.openGlobalPanel()}async runBulkCheck(){await this.realTimeChecker.runBulkCheck()}async getFilesToCheck(){return this.panelManager.getFilesToCheck()}forceIconRefresh(){this.app.workspace.onLayoutReady(()=>{let e=this.app.workspace.getLeavesOfType(S),t=this.app.workspace.getLeavesOfType(T);[...e,...t].forEach(s=>{s.view instanceof v&&s.view.render()})})}};
