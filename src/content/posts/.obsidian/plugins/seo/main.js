/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var ye=Object.prototype.hasOwnProperty;var G=(a,r)=>()=>(a&&(r=a(a=0)),r);var B=(a,r)=>{for(var s in r)V(a,s,{get:r[s],enumerable:!0})},we=(a,r,s,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of me(r))!ye.call(a,t)&&t!==s&&V(a,t,{get:()=>r[t],enumerable:!(e=fe(r,t))||e.enumerable});return a};var ke=a=>we(V({},"__esModule",{value:!0}),a);function x(a){return a.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}function Ce(a){return a.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}async function z(a,r,s){let e=[],t=x(a),n=t.match(/!\[([^\]]*)\]\([^)]+\)/g);if(n){let l=n.filter(u=>{var g;let c=(g=u.match(/!\[([^\]]*)\]/))==null?void 0:g[1];return!c||c.trim()===""});if(l.length>0){let u=l.length,c=u>1,g=l.map(p=>{let d=p.match(/!\[[^\]]*\]\(([^)]+)\)/);return d?d[1]:p});e.push({passed:!1,message:`${u} image${c?"s are":" is"} missing alt text`,suggestion:`Add descriptive alt text for accessibility:<br><br>${g.map(p=>`\u2022 ${p}`).join("<br>")}`,severity:"error"})}}let i=t.match(/!\[\[([^\]]+)\]\]/g);if(i){let l=i.filter(u=>!u.includes("|"));if(l.length>0){let u=l.length,c=u>1,g=l.map(p=>{let d=p.match(/!\[\[([^\]]+)\]\]/);return d?d[1]:p});e.push({passed:!1,message:`${u} wikilink image${c?"s are":" is"} missing alt text`,suggestion:`Add alt text using ![[image.png|alt text]] syntax or consider using standard markdown image syntax:<br><br>${g.map(p=>`\u2022 ${p}`).join("<br>")}`,severity:"error"})}}let o=t.match(/<img[^>]*>/g);if(o){let l=o.filter(u=>{let c=u.match(/alt\s*=\s*["']([^"']*)["']/);return!c||c[1].trim()===""});if(l.length>0){let u=l.length,c=u>1,g=l.map(p=>{let d=p.match(/src\s*=\s*["']([^"']*)["']/);return d?d[1]:"HTML img tag"});e.push({passed:!1,message:`${u} HTML image${c?"s are":" is"} missing alt attribute`,suggestion:`Add alt attribute to HTML img tags:<br><br>${g.map(p=>`\u2022 ${p}`).join("<br>")}`,severity:"error"})}}return e.length===0&&(n&&n.length>0||o&&o.length>0||i&&i.length>0?e.push({passed:!0,message:"All images have alt text",severity:"info"}):e.push({passed:!0,message:"No images in this post",severity:"info"})),e}async function _(a,r,s){let e=[],n=Ce(a).match(/(?<!\]\()https?:\/\/[^\s\)]+/g);return n&&n.forEach((i,o)=>{e.push({passed:!1,message:`Naked link found: ${i}`,suggestion:"Convert to markdown link format: [link text](url)",severity:"warning"})}),e.length===0&&e.push({passed:!0,message:"No naked links found",severity:"info"}),e}async function Z(a,r,s){let e=[],t=a.replace(/^---\n[\s\S]*?\n---\n/,"");t=t.replace(/```[\s\S]*?```/g,""),t=t.replace(/~~~[\s\S]*?~~~/g,"");let n=t.split(`
`),i=null,o=!1;for(let l=0;l<n.length;l++){let c=n[l].match(/^(#{1,6})\s+(.+)/);if(c){o=!0;let g=c[1].length,p=c[2].trim();if(i===null){i=g;continue}g>i+1&&e.push({passed:!1,message:`"${p}" (H${g}) skips heading level(s) after H${i}`,suggestion:"Use heading levels in order (H1 \u2192 H2 \u2192 H3, etc.)",severity:"warning"}),i=g}}return o?e.length===0&&e.push({passed:!0,message:"Heading structure is correct",severity:"info"}):e.push({passed:!0,message:"No heading structure issues found",severity:"info"}),e}async function J(a,r,s){let e=[];if(!s.keywordProperty)return[];let t=a.match(/^---\n([\s\S]*?)\n---/);if(!t)return[];let i=t[1].match(new RegExp(`^${s.keywordProperty}:\\s*(.+)$`,"m"));if(!i)return[];let o=i[1].trim(),l=a.replace(/^---\n[\s\S]*?\n---\n/,""),u=l.split(/\s+/).filter(p=>p.length>0).length,c=(l.toLowerCase().match(new RegExp(o.toLowerCase(),"g"))||[]).length,g=u>0?c/u*100:0;return c===0?e.push({passed:!1,message:`Target keyword "${o}" not found in content`,suggestion:"Include your target keyword naturally in the content",severity:"warning"}):g<s.keywordDensityMin?e.push({passed:!1,message:`Keyword density too low: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${s.keywordDensityMin}-${s.keywordDensityMax}% density`,severity:"warning"}):g>s.keywordDensityMax?e.push({passed:!1,message:`Keyword density too high: ${g.toFixed(1)}% (${c} uses in ${u} words)`,suggestion:`Aim for ${s.keywordDensityMin}-${s.keywordDensityMax}% density`,severity:"warning"}):e.push({passed:!0,message:`Good keyword density: ${g.toFixed(1)}% (${c} uses in ${u} words)`,severity:"info"}),e}async function X(a,r,s,e){var o;let t=[],n=x(a),i=[...n.match(/\[\[([^\]]+)\]\]/g)||[],...n.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let l of i){let u="";if(l.startsWith("[["))u=(((o=l.match(/\[\[([^\]]+)\]\]/))==null?void 0:o[1])||"").split("|")[0];else{let c=l.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=l.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i),p=u.startsWith("/")&&!u.startsWith("//");if(s.publishMode&&p&&!g)continue;c||g?e!=null&&e.metadataCache.getFirstLinkpathDest(u,r.path)||t.push({passed:!1,message:`Broken link: ${u}`,suggestion:g?"Verify the image path exists or check if it's a relative path":"Check if the wikilink target exists or create the target note",severity:"error"}):e!=null&&e.vault.getAbstractFileByPath(u)||t.push({passed:!1,message:`Broken internal link: ${u}`,suggestion:"Check the link path or create the target file",severity:"error"})}}return t.length===0&&t.push({passed:!0,message:"No broken links found",severity:"info"}),t}async function Y(a,r,s,e){var o;let t=[],n=x(a),i=[...n.match(/\[\[([^\]]+)\]\]/g)||[],...n.match(/\[([^\]]+)\]\(([^)]+)\)/g)||[]];for(let l of i){let u="";if(l.startsWith("[["))u=(((o=l.match(/\[\[([^\]]+)\]\]/))==null?void 0:o[1])||"").split("|")[0];else{let c=l.match(/\[([^\]]+)\]\(([^)]+)\)/);u=(c==null?void 0:c[2])||""}if(u&&!u.startsWith("http")){let c=l.startsWith("[["),g=u.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i),p=u.startsWith("/")&&!u.startsWith("//");if(s.publishMode&&p&&!g){t.push({passed:!1,message:`Potentially broken link: ${u}`,suggestion:"Relative path that may be resolved by your site generator. Verify the target page will resolve on your published site.",severity:"warning"});continue}(c||g)&&(e!=null&&e.metadataCache.getFirstLinkpathDest(u,r.path))&&c&&t.push({passed:!1,message:`Potentially broken link: ${u}`,suggestion:"Wikilinks may not work on the web - consider converting to standard markdown links",severity:"warning"})}}return t.length===0&&t.push({passed:!0,message:"No potentially broken links found",severity:"info"}),t}async function Q(a,r,s){let e=[];if(!s.descriptionProperty)return[];let t=a.match(/^---\n([\s\S]*?)\n---/);if(!t)return e.push({passed:!1,message:"No frontmatter found",suggestion:"Add frontmatter with description property",severity:"warning"}),e;let i=t[1].match(new RegExp(`^${s.descriptionProperty}:\\s*(.+)$`,"m"));if(!i)return e.push({passed:!1,message:`No ${s.descriptionProperty} found in frontmatter`,suggestion:`Add ${s.descriptionProperty} to frontmatter`,severity:"warning"}),e;let l=i[1].trim().length;return l<120?e.push({passed:!1,message:`Description too short: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):l>160?e.push({passed:!1,message:`Description too long: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):e.push({passed:!0,message:`Good description length: ${l} characters`,severity:"info"}),e}async function ee(a,r,s){let e=[];if(!s.titleProperty)return[];let t="";if(s.useFilenameAsTitle)t=r.basename;else{let i=a.match(/^---\n([\s\S]*?)\n---/);if(i){let l=i[1].match(new RegExp(`^${s.titleProperty}:\\s*(.+)$`,"m"));l&&(t=l[1].trim())}}if(!t)return[];let n=t.length;return n<30?e.push({passed:!1,message:`Title too short: ${n} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):n>60?e.push({passed:!1,message:`Title too long: ${n} characters`,suggestion:"Aim for 30-60 characters.",severity:"warning"}):e.push({passed:!0,message:`Good title length: ${n} characters`,severity:"info"}),e}async function te(a,r,s){let e=[];if(!s.checkContentLength)return[{passed:!0,message:"Content length check disabled",severity:"info"}];let t=a.replace(/^---\n[\s\S]*?\n---\n/,"");t=t.replace(/```[\s\S]*?```/g,""),t=t.replace(/~~~[\s\S]*?~~~/g,"");let n=t.split(/\s+/).filter(i=>i.length>0).length;return n<s.minContentLength?e.push({passed:!1,message:`Content too short: ${n} words`,suggestion:`Aim for at least ${s.minContentLength} words for better SEO`,severity:"warning"}):e.push({passed:!0,message:`Good content length: ${n} words`,severity:"info"}),e}async function se(a,r,s){let e=[];if(!s.checkImageNaming)return[{passed:!0,message:"Image naming check disabled",severity:"info"}];let n=x(a).match(/!\[[^\]]*\]\(([^)]+)\)/g);return n&&n.forEach((i,o)=>{var u;let l=(u=i.match(/!\[[^\]]*\]\(([^)]+)\)/))==null?void 0:u[1];if(l){let c=l.split("/").pop()||"";c.includes(" ")||c.includes("%20")?e.push({passed:!1,message:`Image ${o+1} has spaces in filename: ${c}`,suggestion:"Use kebab-case or underscores instead of spaces",severity:"warning"}):c.match(/^[a-f0-9]{8,}$/)?e.push({passed:!1,message:`Image ${o+1} has random filename: ${c}`,suggestion:"Use descriptive filenames for better SEO",severity:"warning"}):c.toLowerCase().includes("pasted")||c.toLowerCase().includes("image")||c.toLowerCase().includes("untitled")||c.toLowerCase().includes("screenshot")||c.toLowerCase().includes("photo")?e.push({passed:!1,message:`Image ${o+1} has generic filename: ${c}`,suggestion:"Use descriptive filenames for better SEO",severity:"warning"}):(c.length<5||c.length>50)&&e.push({passed:!1,message:`Image ${o+1} has inappropriate filename length: ${c}`,suggestion:"Use descriptive filenames between 5-50 characters",severity:"warning"})}}),e.length===0&&e.push({passed:!0,message:"All images have good filenames",severity:"info"}),e}async function ne(a,r,s){let e=[];if(!s.checkDuplicateContent)return[];let t=globalThis.app;if(!t)return e;let n;if(s.scanDirectories.trim()){let c=s.scanDirectories.split(",").map(g=>g.trim());n=t.vault.getMarkdownFiles().filter(g=>c.some(p=>g.path.startsWith(p+"/")||g.path.startsWith(p+"\\")))}else n=t.vault.getMarkdownFiles();let i=n.filter(c=>c.path!==r.path);if(i.length===0)return e.push({passed:!0,message:"No other files to compare against",severity:"info"}),e;let l=x(a).split(`

`).filter(c=>c.trim().length>100).map(c=>c.trim().toLowerCase().replace(/\s+/g," "));if(l.length===0)return e.push({passed:!0,message:"No substantial content to check",severity:"info"}),e;let u=[];for(let c of l){let g=[];for(let p of i)try{let d=await t.vault.read(p);x(d).split(`

`).filter(f=>f.trim().length>100).map(f=>f.trim().toLowerCase().replace(/\s+/g," ")).includes(c)&&g.push(p.path)}catch(d){continue}g.length>0&&u.push({paragraph:c,duplicateFiles:g})}if(u.length>0){let c=u.length,g=[...new Set(u.flatMap(p=>p.duplicateFiles))];e.push({passed:!1,message:`Found ${c} paragraph(s) duplicated in other files`,suggestion:`Duplicate content found. Review and rewrite duplicate content to improve SEO.<br><br>${g.map(p=>`\u2022 ${p}`).join("<br>")}`,severity:"warning"})}else e.push({passed:!0,message:"No duplicate content found across vault",severity:"info"});return e}async function ie(a,r,s){let e=[];if(!s.checkReadingLevel)return[{passed:!0,message:"Reading level check disabled",severity:"info"}];let t=a.replace(/^---\n[\s\S]*?\n---\n/,"");t=t.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/https?:\/\/[^\s]+/g,"").trim();let n=t.split(/[.!?]+/).filter(p=>p.trim().length>10),i=t.split(/\s+/).filter(p=>p.length>0&&/^[a-zA-Z]/.test(p)),o=i.reduce((p,d)=>p+Ee(d),0);if(n.length===0||i.length<10)return e.push({passed:!0,message:"Not enough content for reading level analysis",severity:"info"}),e;let l=i.length/n.length,u=o/i.length,c=206.835-1.015*l-84.6*u,g;return c>=90?g=5:c>=80?g=6:c>=70?g=7:c>=60?g=8:c>=50?g=9:c>=30?g=10:g=12,g>15?e.push({passed:!1,message:`Reading level too high: ${g.toFixed(1)} (Graduate level)`,suggestion:"Consider simplifying language for broader audience",severity:"warning"}):g<4?e.push({passed:!1,message:`Reading level too low: ${g.toFixed(1)} (Elementary level)`,suggestion:"Consider using more sophisticated language",severity:"warning"}):e.push({passed:!0,message:`Good reading level: ${g.toFixed(1)} (${Se(g)})`,severity:"info"}),e}async function re(a,r,s){let e=[];if(!s.showNotices)return[{passed:!0,message:"Notices check disabled",severity:"info"}];let t=a.match(/\[\[([^\]]+)\]\]/g);if(t){let i=t.map(o=>{let l=o.match(/\[\[([^\]]+)\]\]/);return l?l[1]:o});e.push({passed:!1,message:`Found ${t.length} wikilink(s) that may not render on web`,suggestion:`Consider converting to markdown links for web publishing:<br><br>${i.map(o=>`\u2022 ${o}`).join("<br>")}`,severity:"warning"})}let n=a.match(/!\[[^\]]*\]\([^)]+\)/g);if(n){let i=n.map(o=>{let l=o.match(/!\[[^\]]*\]\(([^)]+)\)/);return l?l[1]:o});e.push({passed:!1,message:`Found ${n.length} embedded image(s) that may not work on web`,suggestion:`Ensure images are properly linked and accessible:<br><br>${i.map(o=>`\u2022 ${o}`).join("<br>")}`,severity:"warning"})}return e.length===0&&e.push({passed:!0,message:"No web compatibility issues found",severity:"info"}),e}async function ae(a,r,s){var l,u;let e=[];if(!s.keywordProperty.trim())return[];let t=a.match(new RegExp(`^${s.keywordProperty}:\\s*(.+)$`,"m")),n=(l=t==null?void 0:t[1])==null?void 0:l.trim();if(!n)return[{passed:!0,message:"No keyword found in frontmatter",severity:"info"}];let i="";if(s.useFilenameAsSlug)i=r.basename;else if(s.slugProperty.trim()){let c=a.match(new RegExp(`^${s.slugProperty}:\\s*(.+)$`,"m"));i=((u=c==null?void 0:c[1])==null?void 0:u.trim())||""}return i?(i.toLowerCase().includes(n.toLowerCase())?e.push({passed:!0,message:`Keyword "${n}" found in slug`,severity:"info"}):e.push({passed:!1,message:`Keyword "${n}" not found in slug`,suggestion:`Consider including your target keyword in the slug for better SEO. Current slug: "${i}"`,severity:"warning"}),e):[{passed:!0,message:"No slug found",severity:"info"}]}async function oe(a,r,s){var i;let e=[],t="";if(s.useFilenameAsSlug)t=r.basename;else if(s.slugProperty.trim()){let o=a.match(new RegExp(`^${s.slugProperty}:\\s*(.+)$`,"m"));t=((i=o==null?void 0:o[1])==null?void 0:i.trim())||""}if(!t)return[{passed:!0,message:"No slug found",severity:"info"}];let n=[];return t.includes(" ")&&n.push("contains spaces"),t.toLowerCase().includes("untitled")&&n.push('contains "Untitled"'),t.match(/^[a-f0-9]{8,}$/i)&&n.push("appears to be a random string"),t.match(/[<>:"'|?*]/)&&n.push("contains illegal URL characters"),t.match(/[-_]{2,}/)&&n.push("has multiple consecutive separators"),n.length>0?e.push({passed:!1,message:`Slug format issues: ${n.join(", ")}`,suggestion:`Use kebab-case format (e.g., "my-awesome-post") or underscores (e.g., "my_awesome_post"). Current slug: "${t}"`,severity:"warning"}):e.push({passed:!0,message:"Slug format looks good",severity:"info"}),e}function Ee(a){if(a=a.toLowerCase(),a.length<=3)return 1;let r="aeiouy",s=0,e=!1;for(let t=0;t<a.length;t++){let n=r.includes(a[t]);n&&!e&&s++,e=n}return a.endsWith("e")&&s--,s===0&&(s=1),s}function Se(a){return a<6?"Elementary":a<8?"Middle School":a<10?"High School":a<12?"College Prep":"College"}async function le(a,r,s){let e=[];if(!s.keywordProperty.trim())return[];let t="",n="",i=a.match(/^---\n([\s\S]*?)\n---/);if(i){let p=i[1].match(new RegExp(`^${s.keywordProperty}:\\s*(.+)$`,"m"));p&&(n=p[1].trim())}if(s.useFilenameAsTitle)t=r.basename;else if(s.titleProperty.trim()&&i){let p=i[1].match(new RegExp(`^${s.titleProperty}:\\s*(.+)$`,"m"));p&&(t=p[1].trim())}if(!t||!n)return[];let o=t.toLowerCase();return n.toLowerCase().split(/\s+/).filter(g=>g.length>0).every(g=>o.includes(g))?e.push({passed:!0,message:`Target keyword "${n}" found in title`,severity:"info"}):e.push({passed:!1,message:`Target keyword "${n}" not found in title`,suggestion:"Include your target keyword in the title for better SEO",severity:"warning"}),e}var ce=G(()=>{});var S={};B(S,{clearAllCache:()=>Ne,clearCache:()=>Re,clearCacheForFile:()=>$e,getCacheStats:()=>Le,runSEOCheck:()=>Te});async function Te(a,r){let s=[];for(let e of r)try{let t=Oe(e,a);if(t){s.push(t);continue}let n=await a.app.vault.read(e),i=await Pe(a,e,n);Fe(e,i,a),s.push(i)}catch(t){console.error(`Error checking file ${e.path}:`,t)}return s}async function Pe(a,r,s){let e={titleLength:await ee(s,r,a.settings),metaDescription:await Q(s,r,a.settings),keywordInTitle:await le(s,r,a.settings),keywordInSlug:await ae(s,r,a.settings),slugFormat:await oe(s,r,a.settings),keywordDensity:await J(s,r,a.settings),headingOrder:await Z(s,r,a.settings),contentLength:await te(s,r,a.settings),duplicateContent:await ne(s,r,a.settings),altText:await z(s,r,a.settings),imageNaming:await se(s,r,a.settings),brokenLinks:await X(s,r,a.settings,a.app),potentiallyBrokenLinks:await Y(s,r,a.settings,a.app),nakedLinks:await _(s,r,a.settings),readingLevel:await ie(s,r,a.settings),notices:await re(s,r,a.settings)},t=Object.values(e).flat(),n=t.filter(l=>l.severity==="error").length,i=t.filter(l=>l.severity==="warning").length,o;if(t.length===0)o=100;else{let l=0,u=0;t.forEach(h=>{let f=1,m=0;h.message.includes("Broken link")&&!h.passed||h.message.includes("title")&&!h.passed?(f=10,m=0):h.message.includes("alt text")&&!h.passed||h.message.includes("meta description")&&!h.passed?(f=5,m=0):h.message.includes("content length")&&!h.passed||h.message.includes("reading level")&&!h.passed?(f=3,m=0):h.severity==="warning"&&!h.passed?(f=1,m=0):h.passed&&(m=100),l+=m*f,u+=f});let c=u>0?l/u:100,g=0,p=t.filter(h=>h.severity==="error"&&!h.passed&&h.message.includes("Broken link")).length;g+=Math.min(p*2,10);let d=t.filter(h=>h.severity==="error"&&!h.passed&&h.message.includes("alt text")).length;g+=Math.min(d*1,5);let v=t.filter(h=>h.severity==="warning"&&!h.passed).length;g+=Math.min(v*.5,5),g=Math.min(g,20),o=Math.max(40,Math.min(100,c-g))}return{file:r.path,checks:e,overallScore:o,issuesCount:n,warningsCount:i}}async function xe(a,r){try{let s=await r.vault.read(a),e=await r.vault.adapter.stat(a.path);return`${s.length}-${e.mtime}`}catch(s){return`${Date.now()}`}}function ue(a){let r={keywordProperty:a.keywordProperty||"",keywordDensityMin:a.keywordDensityMin,keywordDensityMax:a.keywordDensityMax,descriptionProperty:a.descriptionProperty||"",titleProperty:a.titleProperty||"",useFilenameAsTitle:a.useFilenameAsTitle,checkContentLength:a.checkContentLength,minContentLength:a.minContentLength,checkDuplicateContent:a.checkDuplicateContent,scanDirectories:a.scanDirectories||""};return JSON.stringify(r)}function Oe(a,r){let s=P.get(a.path);if(!s)return null;let t=Date.now()-s.timestamp>be,n=ue(r.settings),i=s.settingsHash!==n;return t||i?(P.delete(a.path),null):s.result}async function Fe(a,r,s){let e=await xe(a,s.app),t=ue(s.settings);P.set(a.path,{result:r,timestamp:Date.now(),fileHash:e,settingsHash:t})}function Re(){P.clear()}function Le(){return{size:P.size}}function $e(a){P.delete(a)}function Ne(){P.clear()}var P,be,b=G(()=>{ce();P=new Map,be=24*60*60*1e3});var Ae={};B(Ae,{default:()=>H});module.exports=ke(Ae);var pe=require("obsidian");var j={scanDirectories:"",keywordProperty:"",descriptionProperty:"",titleProperty:"",useFilenameAsTitle:!1,slugProperty:"",useFilenameAsSlug:!1,checkContentLength:!0,checkImageNaming:!0,checkDuplicateContent:!1,checkReadingLevel:!0,showNotices:!0,publishMode:!1,defaultSort:"issues-desc",minContentLength:300,keywordDensityMin:1,keywordDensityMax:2,duplicateThreshold:80,cachedGlobalResults:[],lastScanTimestamp:0};var ve=require("obsidian");function U(a){a.addCommand({id:"seo-open-current",name:"Open current note audit",callback:async()=>{a.openCurrentPanel(),setTimeout(async()=>{let r=a.app.workspace.getLeavesOfType("seo-current-panel")[0];if(r&&r.view){let s=r.view.containerEl.querySelector(".seo-top-btn");s&&s.click()}},200)}}),a.addCommand({id:"seo-open-global",name:"Open vault audit",callback:async()=>{let s=a.app.workspace.getLeavesOfType("seo-global-panel").length===0;a.openGlobalPanel(),setTimeout(async()=>{let e=a.app.workspace.getLeavesOfType("seo-global-panel");if(e.length===0){a.openGlobalPanel();return}let t=e[0];if(t.view){let n=t.view;s?(a.app.workspace.revealLeaf(t),a.app.workspace.setActiveLeaf(t)):(await n.actions.refreshGlobalResults(),n.render())}},300)}})}var w=require("obsidian"),$=class extends w.PluginSettingTab{constructor(s,e){super(s,e);this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Scope"}),new w.Setting(s).setName("Scan directories").setDesc("Comma-separated list of directory names to scan. Leave blank to scan all directories.").addText(n=>n.setPlaceholder("e.g., blog, posts, public").setValue(this.plugin.settings.scanDirectories).onChange(async i=>{this.plugin.settings.scanDirectories=i,await this.plugin.saveSettings()})),s.createEl("h2",{text:"Property Names"}),new w.Setting(s).setName("Keyword property").setDesc("Property name for target keyword (e.g., targetKeyword, seo, keyword)").addText(n=>n.setPlaceholder("targetKeyword").setValue(this.plugin.settings.keywordProperty).onChange(async i=>{this.plugin.settings.keywordProperty=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Description property").setDesc("Property name for meta description").addText(n=>n.setPlaceholder("description").setValue(this.plugin.settings.descriptionProperty).onChange(async i=>{this.plugin.settings.descriptionProperty=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Title property").setDesc("Property name for title (leave blank to skip title checks)").addText(n=>n.setPlaceholder("title").setValue(this.plugin.settings.titleProperty).onChange(async i=>{this.plugin.settings.titleProperty=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Use file name as title").setDesc("Use file name as title instead of a property").addToggle(n=>n.setValue(this.plugin.settings.useFilenameAsTitle).onChange(async i=>{this.plugin.settings.useFilenameAsTitle=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Slug property").setDesc("Property name for slug (leave blank to skip slug checks)").addText(n=>n.setPlaceholder("slug").setValue(this.plugin.settings.slugProperty).onChange(async i=>{this.plugin.settings.slugProperty=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Use file name as slug").setDesc("Use file name as slug instead of a property").addToggle(n=>n.setValue(this.plugin.settings.useFilenameAsSlug).onChange(async i=>{this.plugin.settings.useFilenameAsSlug=i,await this.plugin.saveSettings()})),s.createEl("h2",{text:"Publishing"}),new w.Setting(s).setName("Publish mode").setDesc("Enable when publishing to static site generators (Astro, Jekyll, etc.). Uses flexible validation for relative paths like /page that will be resolved by your site generator.").addToggle(n=>n.setValue(this.plugin.settings.publishMode).onChange(async i=>{this.plugin.settings.publishMode=i,await this.plugin.saveSettings()})),s.createEl("h2",{text:"Check Options"}),new w.Setting(s).setName("Check content length").setDesc("Enable content length checking").addToggle(n=>n.setValue(this.plugin.settings.checkContentLength).onChange(async i=>{this.plugin.settings.checkContentLength=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Check image naming").setDesc("Enable image filename checking").addToggle(n=>n.setValue(this.plugin.settings.checkImageNaming).onChange(async i=>{this.plugin.settings.checkImageNaming=i,await this.plugin.saveSettings()})),new w.Setting(s).setName("Check reading level").setDesc("Enable reading level analysis").addToggle(n=>n.setValue(this.plugin.settings.checkReadingLevel).onChange(async i=>{this.plugin.settings.checkReadingLevel=i,await this.plugin.saveSettings()}));let t=new w.Setting(s).setName("Check duplicate content").setDesc("Enable duplicate content detection").addToggle(n=>n.setValue(this.plugin.settings.checkDuplicateContent).onChange(async i=>{this.plugin.settings.checkDuplicateContent=i,await this.plugin.saveSettings()})).descEl.createEl("div",{text:"\u26A0\uFE0F WARNING: This feature can be very resource-intensive with large vaults and many notes. Disable for faster audits.",cls:"setting-item-description"});t.style.color="#ff6b6b",t.style.fontWeight="bold",t.style.marginTop="4px",new w.Setting(s).setName("Show notices").setDesc("Show web compatibility notices (wikilinks, embedded images)").addToggle(n=>n.setValue(this.plugin.settings.showNotices).onChange(async i=>{this.plugin.settings.showNotices=i,await this.plugin.saveSettings()})),s.createEl("h2",{text:"Thresholds"}),new w.Setting(s).setName("Minimum content length").setDesc("Minimum word count for content length check").addText(n=>n.setPlaceholder("300").setValue(this.plugin.settings.minContentLength.toString()).onChange(async i=>{let o=parseInt(i);isNaN(o)||(this.plugin.settings.minContentLength=o,await this.plugin.saveSettings())})),new w.Setting(s).setName("Keyword density minimum").setDesc("Minimum keyword density percentage").addText(n=>n.setPlaceholder("1").setValue(this.plugin.settings.keywordDensityMin.toString()).onChange(async i=>{let o=parseFloat(i);isNaN(o)||(this.plugin.settings.keywordDensityMin=o,await this.plugin.saveSettings())})),new w.Setting(s).setName("Keyword density maximum").setDesc("Maximum keyword density percentage").addText(n=>n.setPlaceholder("2").setValue(this.plugin.settings.keywordDensityMax.toString()).onChange(async i=>{let o=parseFloat(i);isNaN(o)||(this.plugin.settings.keywordDensityMax=o,await this.plugin.saveSettings())})),new w.Setting(s).setName("Duplicate content threshold").setDesc("Similarity percentage threshold for duplicate content detection").addText(n=>n.setPlaceholder("80").setValue(this.plugin.settings.duplicateThreshold.toString()).onChange(async i=>{let o=parseInt(i);isNaN(o)||(this.plugin.settings.duplicateThreshold=o,await this.plugin.saveSettings())}))}};var M=require("obsidian");var E="seo-current-panel",T="seo-global-panel";function K(a){let r=a.split("/");return r.length<=2?a:r.slice(-2).join("/")}function W(a){return!a||a.trim()===""?"Vault folders: all":`Vault folders: ${a.split(",").map(s=>s.trim()).filter(s=>s.length>0).join(", ")}`}function q(a,r){let s=[...a];switch(r){case"warnings-desc":s.sort((e,t)=>t.warningsCount!==e.warningsCount?t.warningsCount-e.warningsCount:t.issuesCount!==e.issuesCount?t.issuesCount-e.issuesCount:e.file.localeCompare(t.file));break;case"warnings-asc":s.sort((e,t)=>e.warningsCount!==t.warningsCount?e.warningsCount-t.warningsCount:e.issuesCount!==t.issuesCount?e.issuesCount-t.issuesCount:e.file.localeCompare(t.file));break;case"issues-desc":s.sort((e,t)=>t.issuesCount!==e.issuesCount?t.issuesCount-e.issuesCount:t.warningsCount!==e.warningsCount?t.warningsCount-e.warningsCount:e.file.localeCompare(t.file));break;case"issues-asc":s.sort((e,t)=>e.issuesCount!==t.issuesCount?e.issuesCount-t.issuesCount:e.warningsCount!==t.warningsCount?e.warningsCount-t.warningsCount:e.file.localeCompare(t.file));break;case"filename-asc":s.sort((e,t)=>e.file.localeCompare(t.file));break;case"filename-desc":s.sort((e,t)=>t.file.localeCompare(e.file));break}return s}var k=require("obsidian");var N=class{constructor(r,s,e){this.app=r;this.plugin=s;this.panelType=e}async runInitialScan(){try{let r=await this.plugin.getFilesToCheck();if(r.length===0)return[];r.length>20&&new k.Notice(`Running SEO audit on ${r.length} files... This may take a moment.`);let{runSEOCheck:s}=await Promise.resolve().then(()=>(b(),S)),e=await s(this.plugin,r);return this.plugin.settings.cachedGlobalResults=e,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new k.Notice(`SEO audit complete with ${e.length} files.`),e}catch(r){return console.error("Error running initial scan:",r),new k.Notice("Error analyzing files. Check console for details."),[]}}async checkCurrentNote(){let r=this.app.workspace.getActiveFile();if(!r||!r.path.endsWith(".md"))return new k.Notice("Please open a markdown file first."),null;try{let{clearCacheForFile:s}=await Promise.resolve().then(()=>(b(),S));s(r.path);let{runSEOCheck:e}=await Promise.resolve().then(()=>(b(),S)),t=await e(this.plugin,[r]);return t.length>0?(new k.Notice("SEO audit complete."),t[0]):null}catch(s){return console.error("Error checking current note:",s),new k.Notice("Error analyzing current note. Check console for details."),null}}async refreshGlobalResults(){try{let{clearAllCache:r}=await Promise.resolve().then(()=>(b(),S));r();let s=await this.plugin.getFilesToCheck();if(s.length===0)return new k.Notice("No markdown files found in configured directories."),[];s.length>20&&new k.Notice(`Refreshing SEO audit on ${s.length} files... This may take a moment.`);let{runSEOCheck:e}=await Promise.resolve().then(()=>(b(),S)),t=await e(this.plugin,s);return this.plugin.settings.cachedGlobalResults=t,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new k.Notice(`SEO audit complete with ${t.length} files.`),t}catch(r){return console.error("Error checking all notes:",r),new k.Notice("Error analyzing files. Check console for details."),[]}}async openFile(r){if(this.app.vault.getAbstractFileByPath(r)){let e=this.app.workspace.getLeavesOfType("markdown").find(t=>t.view.getState().file===r);e?this.app.workspace.setActiveLeaf(e):(this.app.workspace.openLinkText(r,"",!0),setTimeout(()=>{let t=this.app.workspace.getLeavesOfType("markdown").find(n=>n.view.getState().file===r);t&&this.app.workspace.setActiveLeaf(t)},100))}}async openFileAndAudit(r){let s=this.app.vault.getAbstractFileByPath(r);s&&(await this.app.workspace.getLeaf().openFile(s),this.plugin.openCurrentPanel(),setTimeout(()=>{let e=this.app.workspace.getLeavesOfType(E)[0];if(e){let t=e.view.containerEl.querySelector(".seo-top-btn");t&&t.click()}},200))}showSortMenu(r,s,e,t,n){let i=new k.Menu;i.addItem(o=>{o.setTitle("Issues (high to low)").onClick(()=>{n("issues-desc"),this.sortAndRenderFiles(s,e,"issues-desc")}),t==="issues-desc"&&o.setIcon("check")}),i.addItem(o=>{o.setTitle("Issues (low to high)").onClick(()=>{n("issues-asc"),this.sortAndRenderFiles(s,e,"issues-asc")}),t==="issues-asc"&&o.setIcon("check")}),i.addSeparator(),i.addItem(o=>{o.setTitle("Warnings (high to low)").onClick(()=>{n("warnings-desc"),this.sortAndRenderFiles(s,e,"warnings-desc")}),t==="warnings-desc"&&o.setIcon("check")}),i.addItem(o=>{o.setTitle("Warnings (low to high)").onClick(()=>{n("warnings-asc"),this.sortAndRenderFiles(s,e,"warnings-asc")}),t==="warnings-asc"&&o.setIcon("check")}),i.addSeparator(),i.addItem(o=>{o.setTitle("File name (A to Z)").onClick(()=>{n("filename-asc"),this.sortAndRenderFiles(s,e,"filename-asc")}),t==="filename-asc"&&o.setIcon("check")}),i.addItem(o=>{o.setTitle("File name (Z to A)").onClick(()=>{n("filename-desc"),this.sortAndRenderFiles(s,e,"filename-desc")}),t==="filename-desc"&&o.setIcon("check")}),i.showAtPosition({x:r.clientX,y:r.clientY})}sortAndRenderFiles(r,s,e){let t=q([...r],e),n=s.querySelector(".seo-files-list-container");n&&(n.querySelectorAll(".seo-file-issue").forEach(i=>i.remove()),this.renderFilesList(t,n))}renderFilesList(r,s){r.forEach(e=>{let t=s.createEl("div",{cls:"seo-file-issue"});t.setAttribute("data-file-path",e.file),t.createEl("a",{text:this.getDisplayPath(e.file),cls:"seo-file-link",href:"#"}).addEventListener("click",l=>{l.preventDefault(),this.openFile(e.file)});let i=t.createEl("div",{cls:"seo-stats-container"});i.createEl("span",{text:`${e.issuesCount} issues, ${e.warningsCount} warnings`,cls:"seo-file-stats"});let o=i.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,k.setIcon)(o,"search-check"),o.addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation(),await this.openFileAndAudit(e.file)})})}getDisplayPath(r){let s=r.split("/");return s.length<=2?r:s.slice(-2).join("/")}};var O=require("obsidian");var A=class{constructor(r,s,e){this.container=r;this.onFileClick=s;this.onFileAudit=e;this.isCollapsed=!0}renderResults(r){let s=this.container.createEl("div",{cls:"seo-score-header"}),e=s.createEl("div",{cls:"seo-score-text"});e.createEl("span",{text:"Score: "});let t=e.createEl("span",{text:`${Math.round(r.overallScore)}%`});if(r.overallScore>=80?t.addClass("seo-score-excellent"):r.overallScore>=60?t.addClass("seo-score-good"):r.overallScore>=40?t.addClass("seo-score-fair"):t.addClass("seo-score-poor"),r.issuesCount>0||r.warningsCount>0){e.createEl("span",{text:" ("});let o=e.createEl("span",{text:`${r.issuesCount} issues`,cls:"seo-issues-count-text"});e.createEl("span",{text:", "});let l=e.createEl("span",{text:`${r.warningsCount} warnings`,cls:"seo-warnings-count-text"});e.createEl("span",{text:")"})}else e.createEl("span",{text:" (All checks passed!)",cls:"seo-success"});let n=s.createEl("div",{cls:"seo-toggle-icon"});(0,O.setIcon)(n,"chevrons-down-up"),n.addEventListener("click",()=>{this.isCollapsed=!this.isCollapsed,(0,O.setIcon)(n,this.isCollapsed?"chevrons-up-down":"chevrons-down-up"),this.toggleChecksVisibility()});let i=this.container.createEl("div",{cls:"seo-checks"});this.isCollapsed=!1,Object.entries(r.checks).forEach(([o,l])=>{if(l.length===0)return;let u=l.some(y=>y.severity==="error"),c=l.some(y=>y.severity==="warning"),g=l.every(y=>y.severity==="info"),p="seo-passed";u?p="seo-error":c?p="seo-warning":g&&(p="seo-passed");let d=i.createEl("div",{cls:`seo-check ${p}`}),v=d.createEl("div",{cls:"seo-check-header seo-collapsible-header"}),h=o.replace(/([A-Z])/g," $1").trim().replace(/^./,y=>y.toUpperCase()),f=v.createEl("span",{cls:"seo-collapse-icon"});f.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',v.createEl("span",{text:h});let m=v.createEl("span",{cls:"seo-status"}),he=l.some(y=>y.severity==="error"),de=l.some(y=>y.severity==="warning");he?m.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>':de?m.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>':m.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>';let F=d.createEl("ul",{cls:"seo-results"});F.style.display="block",l.forEach(y=>{let R=F.createEl("li",{cls:`seo-result seo-${y.severity}`,text:y.message});if(y.suggestion){let L=R.createEl("div",{cls:"seo-suggestion"});L.innerHTML=y.suggestion}}),v.addEventListener("click",()=>{let y=F.style.display==="none";F.style.display=y?"block":"none";let R=f.querySelector("svg");if(R&&(R.style.transform=y?"rotate(0deg)":"rotate(-90deg)"),y){this.isCollapsed=!1;let L=this.container.querySelector(".seo-toggle-icon");L&&(0,O.setIcon)(L,"chevrons-down-up")}})})}renderGlobalResults(r){let s=this.container.createEl("div",{cls:"seo-vault-summary"}),e=r.length,t=r.reduce((f,m)=>f+m.issuesCount,0),n=r.reduce((f,m)=>f+m.warningsCount,0),i=Math.round(r.reduce((f,m)=>f+m.overallScore,0)/e),o=s.createEl("div",{cls:"seo-stats-grid"}),l=o.createEl("div",{cls:"seo-stat-item"});l.createEl("div",{cls:"seo-stat-number",text:e.toString()}),l.createEl("div",{cls:"seo-stat-label",text:"Files analyzed"});let u=o.createEl("div",{cls:"seo-stat-item"}),c=u.createEl("div",{cls:"seo-stat-number",text:`${i}%`}),g="Average score";i>=80?(c.addClass("seo-score-excellent"),g="Excellent"):i>=60?(c.addClass("seo-score-good"),g="Good"):i>=40?(c.addClass("seo-score-fair"),g="Fair"):(c.addClass("seo-score-poor"),g="Poor"),u.createEl("div",{cls:"seo-stat-label",text:g});let p=o.createEl("div",{cls:"seo-stat-item"}),d=p.createEl("div",{cls:"seo-stat-number",text:t.toString()});t>0&&d.addClass("seo-issues-count"),p.createEl("div",{cls:"seo-stat-label",text:"Issues"});let v=o.createEl("div",{cls:"seo-stat-item"}),h=v.createEl("div",{cls:"seo-stat-number",text:n.toString()});n>0&&h.addClass("seo-warnings-count"),v.createEl("div",{cls:"seo-stat-label",text:"Warnings"})}renderIssuesList(r,s,e,t){let n=r.filter(p=>p.issuesCount>0||p.warningsCount>0);if(n.length===0)return;let i=this.container.createEl("div",{cls:"seo-issues-list"}),o=i.createEl("div",{cls:"seo-issues-header-container"}),l=o.createEl("span",{cls:"seo-collapse-icon seo-collapsible-header"});l.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6,9 12,15 18,9"/></svg>',o.createEl("h4",{text:"Files with issues",cls:"seo-issues-header"});let u=o.createEl("button",{cls:"seo-sort-btn",attr:{"aria-label":"Sort files"}});(0,O.setIcon)(u,"arrow-up-narrow-wide"),u.addEventListener("click",t);let c=i.createEl("div",{cls:"seo-files-list-container"});this.sortFiles(n,s).forEach(p=>{let d=c.createEl("div",{cls:"seo-file-issue"});d.setAttribute("data-file-path",p.file),d.createEl("a",{text:K(p.file),cls:"seo-file-link",href:"#"}).addEventListener("click",async m=>{m.preventDefault(),await this.onFileClick(p.file)});let h=d.createEl("div",{cls:"seo-stats-container"});h.createEl("span",{text:`${p.issuesCount} issues, ${p.warningsCount} warnings`,cls:"seo-file-stats"});let f=h.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,O.setIcon)(f,"search-check"),f.addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation(),await this.onFileAudit(p.file)})}),o.addEventListener("click",p=>{if(p.target.closest(".seo-sort-btn"))return;let d=c.style.display==="none";c.style.display=d?"block":"none";let v=l.querySelector("svg");v&&(v.style.transform=d?"rotate(0deg)":"rotate(-90deg)")})}sortFiles(r,s){let e=[...r];switch(s){case"warnings-desc":e.sort((t,n)=>{let i=n.warningsCount-t.warningsCount;if(i!==0)return i;let o=n.issuesCount-t.issuesCount;if(o!==0)return o;let l=t.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"warnings-asc":e.sort((t,n)=>{let i=t.warningsCount-n.warningsCount;if(i!==0)return i;let o=t.issuesCount-n.issuesCount;if(o!==0)return o;let l=t.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-desc":e.sort((t,n)=>{let i=n.issuesCount-t.issuesCount;if(i!==0)return i;let o=n.warningsCount-t.warningsCount;if(o!==0)return o;let l=t.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-asc":e.sort((t,n)=>{let i=t.issuesCount-n.issuesCount;if(i!==0)return i;let o=t.warningsCount-n.warningsCount;if(o!==0)return o;let l=t.file.split("/").pop()||"",u=n.file.split("/").pop()||"";return l.localeCompare(u)});break;case"filename-asc":e.sort((t,n)=>{let i=t.file.split("/").pop()||"",o=n.file.split("/").pop()||"",l=i.localeCompare(o);return l!==0?l:t.file.localeCompare(n.file)});break;case"filename-desc":e.sort((t,n)=>{let i=t.file.split("/").pop()||"",l=(n.file.split("/").pop()||"").localeCompare(i);return l!==0?l:n.file.localeCompare(t.file)});break}return e}toggleChecksVisibility(){let r=this.container.querySelector(".seo-checks");if(!r)return;r.querySelectorAll(".seo-check-header").forEach(e=>{var o;let t=e,n=(o=t.parentElement)==null?void 0:o.querySelector(".seo-results"),i=t.querySelector(".seo-collapse-icon svg");n&&i&&(this.isCollapsed?(n.style.display="none",i.style.transform="rotate(-90deg)"):(n.style.display="block",i.style.transform="rotate(0deg)"))})}};var C=class extends M.ItemView{constructor(s,e="current",t){super(t||s.app.workspace.getLeaf());this.currentNoteResults=null;this.globalResults=[];this.panelType="current";this.hasRunInitialScan=!1;this.plugin=s,this.panelType=e,this.currentSort=s.settings.defaultSort,this.actions=new N(this.app,this.plugin,this.panelType),this.resultsDisplay=new A(this.containerEl,async n=>await this.actions.openFile(n),async n=>await this.actions.openFileAndAudit(n))}getViewType(){return this.panelType==="current"?E:T}getDisplayText(){return this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}getIcon(){return"search-check"}async onOpen(){try{this.panelType==="global"&&this.plugin.settings.cachedGlobalResults.length>0&&(this.globalResults=this.plugin.settings.cachedGlobalResults),this.forceIconRefresh(),this.panelType==="global"&&!this.hasRunInitialScan&&this.globalResults.length===0?(this.showLoadingState(),this.hasRunInitialScan=!0,await this.runInitialScan()):this.render()}catch(s){console.error("Error opening SEO panel:",s)}}async onClose(){}cleanup(){}async runInitialScan(){let s=await this.actions.runInitialScan();s.length>0&&(this.globalResults=s,this.render())}forceIconRefresh(){this.leaf&&this.leaf.setViewState({type:this.getViewType(),state:this.leaf.view.getState()}),setTimeout(()=>{let s=this.containerEl.querySelector(".view-header-icon");s&&(s.innerHTML="",s.setAttribute("data-icon","search-check"),s.setAttribute("data-icon",""),s.offsetHeight,s.setAttribute("data-icon","search-check"));let e=this.containerEl.querySelector(".view-header");e&&(e.style.display="none",e.offsetHeight,e.style.display=""),this.app.workspace.trigger("layout-change")},50)}async updateCurrentNoteResults(s){if(!(!s||!s.path.endsWith(".md")))try{let e=await this.app.vault.read(s);this.render()}catch(e){console.error("Error updating current note results:",e)}}async updateResults(s){this.globalResults=s,this.render()}showLoadingState(){let{containerEl:s}=this;s.empty(),s.addClass("seo-panel");let e=s.createEl("div",{cls:"seo-panel-header"});if(e.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="global"){let i=W(this.plugin.settings.scanDirectories),o=e.createEl("div",{cls:"seo-filename"});o.textContent=i}let t=s.createEl("div",{cls:"seo-loading-container"}),n=t.createEl("div",{cls:"seo-loading-spinner"});(0,M.setIcon)(n,"loader-circle"),t.createEl("h3",{text:"Running SEO audit...",cls:"seo-loading-title"}),t.createEl("p",{text:"This may take a moment for large vaults. Please wait...",cls:"seo-loading-message"})}render(){try{let{containerEl:s}=this;s.empty(),s.addClass("seo-panel");let e=s.createEl("div",{cls:"seo-panel-header"});if(e.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="current"){let t=this.app.workspace.getActiveFile();if(t&&t.path.endsWith(".md")){let n=e.createEl("div",{cls:"seo-filename"});n.textContent=`Target note: ${t.path}`}}else{let t=W(this.plugin.settings.scanDirectories),n=e.createEl("div",{cls:"seo-filename"});n.textContent=t}if(this.panelType==="current"){let t=s.createEl("button",{text:"Audit current note",cls:"mod-cta seo-btn seo-top-btn"});t.addEventListener("click",async()=>{let n=t.textContent;t.disabled=!0,t.style.opacity="0.7";try{let i=await this.actions.checkCurrentNote();i&&(this.currentNoteResults=i,this.render())}finally{t.disabled=!1,t.style.opacity="1"}})}this.panelType==="current"?this.currentNoteResults?this.resultsDisplay.renderResults(this.currentNoteResults):s.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Audit current note" to audit it.'}):this.globalResults.length>0?this.renderGlobalResults(s):s.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Click "Audit all notes" to audit your files in your configured directories.'})}catch(s){console.error("Error rendering SEO panel:",s),this.containerEl.createEl("div",{text:"Error loading SEO panel. Please try again."})}}renderGlobalResults(s){this.resultsDisplay.renderGlobalResults(this.globalResults);let e=s.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-refresh-btn"});e.addEventListener("click",async()=>{e.textContent="Refreshing...",e.disabled=!0;try{let t=await this.actions.refreshGlobalResults();t.length>0&&(this.globalResults=t,this.render())}finally{e.textContent="Refresh",e.disabled=!1}}),this.resultsDisplay.renderIssuesList(this.globalResults,this.currentSort,t=>{this.currentSort=t,this.plugin.settings.defaultSort=t,this.plugin.saveSettings()},t=>{let n=this.globalResults.filter(i=>i.issuesCount>0||i.warningsCount>0);this.actions.showSortMenu(t,n,s,this.currentSort,i=>{this.currentSort=i,this.plugin.settings.defaultSort=i,this.plugin.saveSettings()})})}};var ge=require("obsidian");var D=class{constructor(r,s){this.app=r;this.plugin=s}openCurrentPanel(){this.openPanel(E,"current")}openGlobalPanel(){this.openPanel(T,"global")}openPanel(r,s){let e=this.app.workspace.getLeavesOfType(r)[0];if(e)this.app.workspace.revealLeaf(e),this.app.workspace.setActiveLeaf(e),e.view instanceof C&&setTimeout(()=>e.view.forceIconRefresh(),100);else{let t=this.app.workspace.getRightLeaf(!1);if(t){let n=new C(this.plugin,s,t);t.open(n),this.app.workspace.setActiveLeaf(t),setTimeout(()=>{t.view instanceof C&&t.view.forceIconRefresh()},100)}}}async getFilesToCheck(){let{vault:r}=this.app,{scanDirectories:s}=this.plugin.settings;if(!s.trim())return r.getMarkdownFiles();let e=s.split(",").map(n=>n.trim()),t=[];for(let n of e){let i=r.getAbstractFileByPath(n);i&&i instanceof ge.TFolder&&t.push(...r.getMarkdownFiles().filter(o=>o.path.startsWith(n+"/")||o.path===n))}return t}};var I=class{constructor(r,s){this.app=r;this.plugin=s;this.timeoutId=null}registerRealTimeChecking(){this.plugin.registerEvent(this.app.workspace.on("editor-change",()=>{this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.checkCurrentNote()},2e3)}))}async checkCurrentNote(){let r=this.app.workspace.getActiveFile();if(!(!r||!r.path.endsWith(".md")))try{let{runSEOCheck:s}=await Promise.resolve().then(()=>(b(),S)),e=await s(this.plugin,[r])}catch(s){console.error("Error checking current note:",s)}}async runBulkCheck(){let{runSEOCheck:r}=await Promise.resolve().then(()=>(b(),S)),s=await this.plugin.getFilesToCheck();if(s.length!==0)try{let e=await r(this.plugin,s)}catch(e){console.error("Error running bulk check:",e)}}};var H=class extends pe.Plugin{async onload(){await this.loadSettings(),this.panelManager=new D(this.app,this),this.realTimeChecker=new I(this.app,this),this.forceIconRefresh(),this.registerView(E,s=>new C(this,"current",s)),this.registerView(T,s=>new C(this,"global",s)),U(this),this.addSettingTab(new $(this.app,this)),this.realTimeChecker.registerRealTimeChecking(),this.addRibbonIcon("search-check","Open SEO audit panel",async()=>{let e=this.app.workspace.getLeavesOfType("seo-global-panel").length===0;this.openGlobalPanel(),e||setTimeout(async()=>{let t=this.app.workspace.getLeavesOfType("seo-global-panel");if(t.length>0){let n=t[0];if(n.view){let i=n.view;await i.actions.refreshGlobalResults(),i.render()}}},500)})}onunload(){}async loadSettings(){this.settings=Object.assign({},j,await this.loadData())}async saveSettings(){await this.saveData(this.settings);let{clearAllCache:s}=await Promise.resolve().then(()=>(b(),S));s()}addStatusBar(){}removeStatusBar(){}openCurrentPanel(){this.panelManager.openCurrentPanel()}openGlobalPanel(){this.panelManager.openGlobalPanel()}async runBulkCheck(){await this.realTimeChecker.runBulkCheck()}async getFilesToCheck(){return this.panelManager.getFilesToCheck()}forceIconRefresh(){this.app.workspace.onLayoutReady(()=>{let s=this.app.workspace.getLeavesOfType(E),e=this.app.workspace.getLeavesOfType(T);[...s,...e].forEach(t=>{t.view instanceof C&&t.view.render()})})}};
